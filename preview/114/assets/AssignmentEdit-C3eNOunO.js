import{r as f,j as s,L as D,m as b,d as y,a as x,t as h,B as C,T as j,F as I,v}from"./index-Bg9hpXZo.js";import{D as L}from"./DataTable-DksU-o3s.js";import{S as R}from"./SebraDialog-BJGTdvFW.js";import{f as g,t as T}from"./date-0g8_XaQP.js";import{u as A,a as F,b as S,c as k,d as w,D as E}from"./DocumentForm-B-pn2nH_.js";import{L as B}from"./Link-BT-lzrrq.js";import{u as V,I as _}from"./useInteractionsQueries-BFVk66I1.js";import{C as $}from"./ContentTabs-7vERYB6u.js";import{F as K}from"./SebraForm-CrzTULtS.js";import{u as U,a as q,b as H,A as M}from"./useAssignmentsMutations--ZKspjkx.js";import{a as N}from"./useAssignmentsQueries-C_OTWb8I.js";import"./useQueryParam-DT6s2yj8.js";import"./Tooltip-CA7VfZiE.js";import"./createStyled-Cc8KrCXc.js";import"./index.esm-_JfhSvE6.js";import"./useContactsQueries-tHXyty3h.js";import"./Tabs-DHAeeUKT.js";import"./MoreHoriz-DExORUj9.js";import"./FormControlLabel-Bhd4TNSi.js";import"./useCompaniesQueries-CbLVFpmt.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new n.Error().stack;o&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[o]="9ce42576-9637-4ce4-99e4-96b010f0a78a",n._sentryDebugIdIdentifier="sentry-dbid-9ce42576-9637-4ce4-99e4-96b010f0a78a")}catch{}})();const P=({defaultValues:n,where:o})=>{const{data:t=[],isLoading:m}=A(o),c=f.useMemo(()=>t.map(e=>e.document),[t]),{mutate:d}=F(),{mutate:u}=S(),{mutate:r}=k(),{mutate:l}=w();if(!m)return s.jsx(L,{data:c,getRowId:e=>e.id,state:{isLoading:m},columns:[{accessorKey:"alt",header:"Dokumentnamn",Cell:({cell:e,row:a})=>s.jsx(B,{component:D,to:`/documents/${a.original.id}`,children:e.getValue()})},{accessorKey:"mimeType",header:"Filtyp",enableEditing:!1},{accessorKey:"updatedAt",accessorFn:e=>b(e.updatedAt),header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>g(T(e.getValue()))}],renderEditRowDialogContent:({row:e,table:a})=>s.jsx(R,{table:a,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:E}),onCreate:e=>{e.upload?d(e,{onSuccess:a=>r({...n,document:a.doc})}):r({...n,document:e})},onUpdate:e=>u(e),onDelete:e=>l(t.find(a=>a.document.id===e.id))})},ue=()=>{const n=y(),o=x(),{data:t,isLoading:m}=N(n.id==="new"?void 0:n.id),{mutate:c}=U(),{mutate:d}=q(),{mutate:u}=H(),{data:r=[],isLoading:l}=V(),e=f.useMemo(()=>r.filter(i=>h(i.contacts||[],(t==null?void 0:t.responsibleContacts)||[],"id").length>0),[r,t]),a=i=>{t?d({...i,id:t.id}):c(i,{onSuccess:({createAssignment:p})=>o(`/home/assignments/${(p==null?void 0:p.id)||""}`)})};if(!m)return s.jsx(M,{formProps:{values:t},onSubmit:a,renderTopContent:()=>s.jsxs(C,{sx:{position:"relative",mt:1,mb:3},children:[s.jsx(j,{variant:"h4",color:"primary",children:t?"Redigera uppdrag":"LÃ¤gg till uppdrag"}),s.jsx(K,{sx:{position:"absolute",top:0,right:0},onDelete:t?()=>u(t,{onSuccess:()=>o("..")}):void 0,onCancel:()=>o(-1)})]}),renderBottomContent:()=>t&&s.jsx(I,{sx:{mt:1,minHeight:`calc(100vh - ${v}px - 1rem)`},children:s.jsx($,{tabs:[{id:"interactions",label:"Interaktioner",content:s.jsx(_,{interactions:e,isLoading:l,defaultValues:{contacts:[...t.responsibleContacts||[],t.externalContact].filter(i=>!!i),interactionDate:g()}})},{id:"documents",label:"Dokument",content:s.jsx(P,{defaultValues:{entityId:t.id,entityType:"assignment"},where:{entityId:{equals:t.id},entityType:{equals:"assignment"}}})}]})})})};export{ue as default};
//# sourceMappingURL=AssignmentEdit-C3eNOunO.js.map
