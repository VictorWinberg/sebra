import{r as f,j as s,L as b,h as D,o as y,m as x,p as h,B as C,T as j,F as I,q as v}from"./index-DEXIwwaE.js";import{D as L}from"./DataTable-YXH3bEe4.js";import{S as R}from"./SebraDialog-DBAYsK71.js";import{f as g,t as T}from"./date-DATNHocP.js";import{u as A,a as F,b as S,c as k,d as w,D as E}from"./DocumentForm-COGaO2kd.js";import{L as B}from"./Link-FhOdSUb4.js";import{u as V,I as _}from"./useInteractionsQueries-pUrUIM07.js";import{C as $}from"./ContentTabs-AUmpwPrS.js";import{F as q}from"./SebraForm-CheJAgv2.js";import{u as K,a as U,b as H,A as M}from"./useAssignmentsMutations-D1_j5PgD.js";import{a as N}from"./useAssignmentsQueries-BCM1WD0e.js";import"./useQueryParam-Dc7QcaKM.js";import"./Tooltip-CdJQd6n2.js";import"./createStyled-DHiqFG9x.js";import"./index.esm-BRAK56kJ.js";import"./useContactsQueries-BIvpCp3L.js";import"./Tabs-DxVYj5jt.js";import"./MoreHoriz-fZ3LeaTw.js";import"./FormControlLabel-BHWCwbCn.js";import"./useCompaniesQueries-CL33zmna.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new n.Error().stack;a&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[a]="b6b24e2b-7815-4133-89f5-8b752bd80bcd",n._sentryDebugIdIdentifier="sentry-dbid-b6b24e2b-7815-4133-89f5-8b752bd80bcd")}catch{}})();const P=({defaultValues:n,where:a})=>{const{data:t=[],isLoading:m}=A(a),d=f.useMemo(()=>t.map(e=>e.document),[t]),{mutate:c}=F(),{mutate:u}=S(),{mutate:r}=k(),{mutate:l}=w();if(!m)return s.jsx(L,{data:d,getRowId:e=>e.id,state:{isLoading:m},columns:[{accessorKey:"alt",header:"Dokumentnamn",Cell:({cell:e,row:o})=>s.jsx(B,{component:b,to:`/documents/${o.original.id}`,children:e.getValue()})},{accessorKey:"mimeType",header:"Filtyp",enableEditing:!1},{accessorKey:"updatedAt",accessorFn:e=>D(e.updatedAt),header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>g(T(e.getValue()))}],renderEditRowDialogContent:({row:e,table:o})=>s.jsx(R,{table:o,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:E}),onCreate:e=>{e.upload?c(e,{onSuccess:o=>r({...n,document:o.doc})}):r({...n,document:e})},onUpdate:e=>u(e),onDelete:e=>l(t.find(o=>o.document.id===e.id))})},ue=()=>{const n=y(),a=x(),{data:t,isLoading:m}=N(n.id==="new"?void 0:n.id),{mutate:d}=K(),{mutate:c}=U(),{mutate:u}=H(),{data:r=[],isLoading:l}=V(),e=f.useMemo(()=>r.filter(i=>h(i.contacts||[],(t==null?void 0:t.responsibleContacts)||[],"id").length>0),[r,t]),o=i=>{t?c({...i,id:t.id}):d(i,{onSuccess:({createAssignment:p})=>a(`/home/assignments/${(p==null?void 0:p.id)||""}`)})};if(!m)return s.jsx(M,{formProps:{values:t},onSubmit:o,renderTopContent:()=>s.jsxs(C,{sx:{position:"relative",mt:1,mb:3},children:[s.jsx(j,{variant:"h4",color:"primary",children:t?"Redigera uppdrag":"LÃ¤gg till uppdrag"}),s.jsx(q,{sx:{position:"absolute",top:0,right:0},onDelete:t?()=>u(t,{onSuccess:()=>a("..")}):void 0,onCancel:()=>a(-1)})]}),renderBottomContent:()=>t&&s.jsx(I,{sx:{mt:1,minHeight:`calc(100vh - ${v}px - 1rem)`},children:s.jsx($,{tabs:[{id:"interactions",label:"Interaktioner",content:s.jsx(_,{interactions:e,isLoading:l,defaultValues:{contacts:[...t.responsibleContacts||[],t.externalContact].filter(i=>!!i),interactionDate:g()}})},{id:"documents",label:"Dokument",content:s.jsx(P,{defaultValues:{entityId:t.id,entityType:"assignment"},where:{entityId:{equals:t.id},entityType:{equals:"assignment"}}})}]})})})};export{ue as default};
//# sourceMappingURL=AssignmentEdit-B3V9i5EI.js.map
