import{J as S,j as n,U as C,m as L,o as Q,s as y,V as U,W as _,X as K,Y as P,f as q,r as f,B as I,G as p,t as k,S as H}from"./index-DtM-SVu8.js";import{v as T,p as R,u as x,c as w,e as F,A as B}from"./useSnackbar-Dcl7AvjU.js";import{u as N,C as b}from"./index.esm-Cnf2oWlC.js";import{F as O,s as M}from"./FlexGrow-BkZwbmlW.js";const z=S(n.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload"),A=S(n.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),V=async e=>await C("document_references",e),W=async e=>{T(e,["documentId","entityType","entityId"]),await L("document_references",R(e,["documentId","entityType","entityId"]))},$=async({row:e,where:t})=>{await g(t),await W(e)},g=async e=>{await Q("document_references",R(e,["documentId","entityType","entityId"]))},se=()=>{const e=y(),{showSnackbar:t}=x();return w({mutationFn:U,onSuccess:()=>{e.invalidateQueries({queryKey:["documents"]}),t("Dokumentet sparat!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle sparas.","error")}})},ce=()=>{const e=y(),{showSnackbar:t}=x();return w({mutationFn:r=>Promise.all([_(r),g(r)]),onSuccess:()=>{e.invalidateQueries({queryKey:["documents"]}),e.invalidateQueries({queryKey:["document_references"]}),t("Dokumentet borttaget!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle tas bort.","error")}})},ue=()=>{const e=y(),{showSnackbar:t}=x();return w({mutationFn:W,onSuccess:()=>{e.invalidateQueries({queryKey:["document_references"]}),t("Dokument skapat!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle skapas.","error")}})},ie=()=>{const e=y(),{showSnackbar:t}=x();return w({mutationFn:$,onSuccess:()=>{e.invalidateQueries({queryKey:["document_references"]}),t("Dokument uppdaterat!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle uppdateras.","error")}})},ae=()=>{const e=y(),{showSnackbar:t}=x();return w({mutationFn:g,onSuccess:()=>{e.invalidateQueries({queryKey:["document_references"]}),t("Dokument borttaget!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle tas bort.","error")}})},G=()=>F({queryKey:["documents"],queryFn:K}),de=e=>F({queryKey:["documents",e],queryFn:()=>P(e),enabled:!!e}),le=e=>F({queryKey:["document_references",e],queryFn:()=>V(e),enabled:e&&Object.keys(e).length>0}),Y=({onChange:e,children:t,...r})=>{const i=a=>{var d;const h=(d=a.target.files)==null?void 0:d[0];h&&(e==null||e(h))};return n.jsxs(q,{component:"label",role:void 0,variant:"contained",tabIndex:-1,startIcon:n.jsx(A,{}),...r,children:[t,n.jsx("input",{type:"file",style:{display:"none"},onChange:i})]})};function X(){const[e,t]=f.useState([window.innerWidth,window.innerHeight]);return f.useEffect(()=>{const r=J(()=>{t([window.innerWidth,window.innerHeight])},200);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),e}const J=(e,t)=>{let r;return(...i)=>{let a;return clearTimeout(r),r=setTimeout(()=>{a=e(...i)},t),a}},Z=["application/pdf","application/json","image/*","text/*","video/*","audio/*"],ee=({file:e})=>{const t=X(),r=f.useRef(null),[i,a]=f.useState();if(f.useEffect(()=>{e&&Z.some(u=>e.type.match(u))?a(URL.createObjectURL(e)):a(void 0)},[e]),!e||!i)return null;const h=()=>{if(r.current&&r.current.contentWindow){const u=r.current,v=r.current.contentWindow.document,l=u.clientHeight,D=u.clientWidth,s=v.documentElement.scrollHeight,j=v.documentElement.scrollWidth,c=D/j,o=l/s,m=Math.min(c,o);u.style.transform=`scale(${m})`,u.style.transformOrigin="top left",u.style.width=`${j}px`,u.style.height=`${s}px`}},d=()=>e.type.startsWith("image/")?n.jsx("img",{src:i,alt:"Preview",style:{width:"100%",height:"100%",maxHeight:"33vh",objectFit:"cover"}}):n.jsx("iframe",{ref:r,src:i,title:"Preview",onLoad:h,style:{width:"100%",height:"33vh",border:"none"}},`${t}`);return n.jsx(I,{sx:{mx:-1,overflow:"hidden"},children:n.jsx(I,{sx:{width:"100%",height:"33vh",px:1},children:d()},i)})},me=({onSubmit:e=()=>{},onChange:t,formProps:r,enableExistingDocuments:i,children:a,...h})=>{const{data:d=[]}=G(),{control:u,handleSubmit:E,watch:v,setValue:l,formState:{errors:D}}=N(r),s=v();f.useEffect(()=>{t==null||t(s)},[t,s]);const j=c=>{l("documentName",c.name),l("content",c)};return f.useEffect(()=>{if(s.documentId){const c=d.find(o=>o.documentId===s.documentId);c&&(l("documentName",c.documentName),l("content",c.content))}else l("documentName",""),l("content",void 0)},[s.documentId,l,d]),n.jsx(O,{...h,children:n.jsxs("form",{onSubmit:E(e),style:{...M},children:[n.jsxs(p,{container:!0,spacing:2,children:[n.jsx(p,{item:!0,xs:12,sm:6,children:n.jsx(b,{control:u,name:"documentName",rules:{required:!0},defaultValue:"",render:({field:c,fieldState:o})=>n.jsx(k,{fullWidth:!0,label:"Dokumentnamn",type:"text",margin:"none",...c,error:!!o.error})})}),n.jsx(p,{item:!0,xs:12,sm:6,children:n.jsx(b,{control:u,name:"content",rules:{required:!0},render:({field:c})=>{var o,m;return n.jsx(k,{fullWidth:!0,label:"Dokument",type:"text",margin:"none",value:((o=c.value)==null?void 0:o.name)||"",disabled:!0,error:!!D.content,InputProps:{endAdornment:(m=s.content)==null?void 0:m.type}})}})}),i&&n.jsx(p,{item:!0,xs:12,children:n.jsx(b,{name:"documentId",control:u,render:({field:c})=>n.jsx(B,{options:d,getOptionKey:o=>o.documentId,getOptionLabel:o=>o.documentName,value:d.find(o=>o.documentId===c.value)||null,onChange:(o,m)=>c.onChange(m?m.documentId:void 0),renderInput:o=>n.jsx(k,{...o,label:"Existerande dokument",variant:"outlined",fullWidth:!0})})})}),n.jsx(p,{item:!0,xs:12,children:n.jsx(ee,{file:s.content})}),n.jsx(p,{item:!0,xs:12,children:n.jsxs(H,{spacing:2,direction:"row",children:[n.jsx(Y,{onChange:j,children:s.content?"Ersätt dokument":"Välj dokument"}),n.jsx(q,{startIcon:n.jsx(z,{}),variant:"contained",href:s.content?URL.createObjectURL(s.content):"#",download:s.documentName,disabled:!s.content,children:"Ladda ner"})]})})]}),a]})})};export{me as D,se as a,ue as b,ae as c,le as d,ce as e,de as f,ie as g,G as u};
