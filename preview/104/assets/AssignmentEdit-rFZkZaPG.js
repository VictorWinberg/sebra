import{r as p,j as s,h as D,L as x,i as b,k as h,l as I,B as C,T as j,F as y,m as L}from"./index-BzkFRqDI.js";import{D as R}from"./DataTable-DUGFV4QA.js";import{S as A}from"./SebraDialog-Dw7cExYl.js";import{f as g,t as v}from"./date-CK5HKMz2.js";import{t as F,i as S,F as T}from"./useSnackbar-jRacW-mS.js";import{u as k,a as E,b as M,c as w,d as B,D as N}from"./DocumentForm-WjHXHc50.js";import{u as V,I as $}from"./useInteractionsQueries-BTRNsRKH.js";import{C as K}from"./ContentTabs-CxWjykgz.js";import{u as H,a as P,b as U,A as G}from"./useAssignmentsMutations-uVpIQ8qF.js";import{a as q}from"./useAssignmentsQueries-CvCC9xRv.js";import"./useQueryParam-4e8L4EYV.js";import"./Tooltip-CbnF0fP4.js";import"./MoreHoriz-6iwLalLo.js";import"./index.esm-ce09msfH.js";import"./Tabs-fcE8mwy6.js";import"./useContactsQueries-8yE_gSee.js";import"./useCompaniesQueries-Bt1v90gs.js";const z=({defaultValues:i})=>{const{data:o=[],isLoading:n}=k(i),{data:r=[],isLoading:d}=E(),u=p.useMemo(()=>{const e=F(r,"documentId");return o.map(t=>e.get(t.documentId)).filter(t=>!!t)},[r,o]),{mutate:c}=M(),{mutate:m}=w(),{mutate:l}=B();return s.jsx(R,{data:u,getRowId:e=>e.documentId,state:{isLoading:d||n},columns:[{accessorKey:"documentName",header:"Dokumentnamn",Cell:({cell:e,row:t})=>s.jsx(D,{component:x,to:`/documents/${t.original.documentId}`,children:e.getValue()})},{accessorKey:"content.type",accessorFn:e=>{var t;return(t=e.content)==null?void 0:t.type},header:"Filtyp",enableEditing:!1},{accessorKey:"content.lastModified",accessorFn:e=>{var t;return b((t=e.content)==null?void 0:t.lastModified)},header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>g(v(e.getValue()))}],renderEditRowDialogContent:({row:e,table:t})=>s.jsx(A,{table:t,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:N}),onCreate:e=>c(e,{onSuccess:t=>m({...i,documentId:t})}),onUpdate:e=>c(e),onDelete:e=>l(e)})},me=()=>{const i=h(),o=I(),{data:n,isLoading:r}=q(i.id==="new"?void 0:Number(i.id)),{mutate:d}=H(),{mutate:u}=P(),{mutate:c}=U(),{data:m=[],isLoading:l}=V(),e=p.useMemo(()=>m.filter(a=>S(a.contacts,(n==null?void 0:n.responsibleContacts)||[],"contactId").length>0),[m,n]),t=a=>{n?u(a):d(a,{onSuccess:f=>o(`/home/assignments/${f.assignmentId}`)})};if(!r)return s.jsx(G,{formProps:{values:n},onSubmit:t,renderTopContent:()=>s.jsxs(C,{sx:{position:"relative",mt:1,mb:3},children:[s.jsx(j,{variant:"h4",color:"primary",children:n?"Redigera uppdrag":"LÃ¤gg till uppdrag"}),s.jsx(T,{sx:{position:"absolute",top:0,right:0},onDelete:n?()=>c(n,{onSuccess:()=>o("..")}):void 0,onCancel:()=>o(-1)})]}),renderBottomContent:()=>n&&s.jsx(y,{sx:{mt:1,minHeight:`calc(100vh - ${L}px - 1rem)`},children:s.jsx(K,{tabs:[{id:"interactions",label:"Interaktioner",content:s.jsx($,{interactions:e,isLoading:l,defaultValues:{contacts:[...n.responsibleContacts,n.externalContact].filter(a=>!!a),interactionDate:g()}})},{id:"documents",label:"Dokument",content:s.jsx(z,{defaultValues:{entityId:n.assignmentId,entityType:"assignment"}})}]})})})};export{me as default};
