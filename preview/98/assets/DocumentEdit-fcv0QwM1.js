import{r as g,j as e,G as T,M as P,N as U,Q as V,w as _,i as B,k as G,B as O,S as q,f as R,l as W,T as Y,g as I,L as S,U as Q}from"./index-CCoyQ5Fl.js";import{A as z,t as k,D as H,a as J,b as X,M as Z}from"./useSnackbar-DtZAqGvd.js";import{u as C}from"./useAssignmentsQueries-CjitgZPD.js";import{u as F}from"./useCompaniesQueries-BP6wd0J5.js";import{u as $}from"./useContactsQueries-BVCqg1FD.js";import{C as ee}from"./ContentTabs-CMknDPLx.js";import{a as te,D as ae}from"./DataTable-Bs2bmu0K.js";import{F as w,s as se}from"./FlexGrow-C7TTiM9g.js";import{f as ne,a as re,e as oe,d as ce,b as ie,g as le,c as me,D as ue}from"./DocumentForm-BycwSQFV.js";import{u as de,C as E}from"./index.esm-DNhKaJpn.js";import{M as N}from"./MoreHoriz-B24txcgq.js";import"./Tooltip-DD5YKbpU.js";import"./useQueryParam-C_rbOO5m.js";const pe=[{label:"Bolag",value:"company"},{label:"Kontakt",value:"contact"},{label:"Uppdrag",value:"assignment"}],ge=({onSubmit:c=()=>{},onChange:r,formProps:o,renderTopContent:l,renderBottomContent:m,...j})=>{const{data:u=[]}=$(),{data:d=[]}=C(),{data:p=[]}=F(),{control:x,handleSubmit:b,watch:D,formState:{errors:v}}=de(o),i=D();g.useEffect(()=>{r==null||r(i)},[r,i]);const f=g.useMemo(()=>{switch(i.entityType){case"company":return p.map(a=>({id:a.companyId,label:a.companyName}));case"contact":return u.map(a=>({id:a.contactId,label:a.contactName}));case"assignment":return d.map(a=>({id:a.assignmentId,label:a.assignmentName}));default:return[]}},[i.entityType,p,u,d]);return e.jsx(w,{...j,children:e.jsxs("form",{onSubmit:b(c),style:{...se},children:[l==null?void 0:l(),e.jsxs(T,{container:!0,spacing:2,children:[e.jsx(T,{item:!0,xs:12,sm:6,children:e.jsxs(P,{fullWidth:!0,variant:"outlined",error:!!v.entityType,children:[e.jsx(U,{children:"Typ"}),e.jsx(E,{control:x,name:"entityType",defaultValue:"",rules:{required:!0},render:({field:a})=>e.jsxs(V,{label:"Typ",...a,children:[e.jsx(N,{value:"",disabled:!0,children:"V채lj typ"}),pe.map(s=>e.jsx(N,{value:s.value,children:s.label},s.value))]})})]})}),e.jsx(T,{item:!0,xs:12,sm:6,children:e.jsx(E,{name:"entityId",control:x,rules:{required:!0},render:({field:a})=>e.jsx(z,{options:f,getOptionKey:s=>s.id,getOptionLabel:s=>s.label,value:f.find(s=>s.id===a.value)||null,onChange:(s,h)=>a.onChange(h?h.id:void 0),renderInput:s=>e.jsx(_,{...s,label:"L채nk",variant:"outlined",fullWidth:!0})})})})]}),m==null?void 0:m()]})})},Le=()=>{const c=B(),r=G(),{data:o,isLoading:l}=ne(c.id==="new"?void 0:c.id),{mutate:m}=re(),{mutate:j}=oe(),{data:u=[]}=F(),{data:d=[]}=$(),{data:p=[]}=C(),{data:x=[],isLoading:b}=ce(c.id!=="new"?{documentId:c.id}:void 0),{mutate:D}=ie(),{mutate:v}=le(),{mutate:i}=me(),f=g.useMemo(()=>k(u,"companyId"),[u]),a=g.useMemo(()=>k(d,"contactId"),[d]),s=g.useMemo(()=>k(p,"assignmentId"),[p]),h=t=>{m(t,{onSuccess:n=>r(`/documents/${n}`)})};if(l)return;const A=t=>{switch(t){case"company":return"Bolag";case"contact":return"Kontakt";case"assignment":return"Uppdrag";default:return null}},K=(t,n)=>{var y,L,M;switch(t){case"company":return e.jsx(I,{component:S,to:`/home/companies/${n}`,children:(y=f.get(n))==null?void 0:y.companyName});case"contact":return e.jsx(I,{component:S,to:`/home/contacts/${n}`,children:(L=a.get(n))==null?void 0:L.contactName});case"assignment":return e.jsx(I,{component:S,to:{pathname:`/home/assignments/${n}`,search:`${Q({tab:"documents"})}`},children:(M=s.get(n))==null?void 0:M.assignmentName});default:return null}};return e.jsx(ue,{formProps:{defaultValues:o},onSubmit:h,renderTopContent:()=>e.jsxs(O,{sx:{position:"relative",mt:1,mb:3},children:[e.jsxs(q,{spacing:2,direction:"row",sx:{position:"absolute",right:0},children:[o&&e.jsx(te,{onClick:()=>j(o,{onSuccess:()=>r("..")}),children:t=>e.jsx(R,{variant:"outlined",color:"error",...W(t),children:"Ta bort"})}),e.jsx(R,{variant:"outlined",color:"primary",onClick:()=>r(-1),children:"Avbryt"}),e.jsx(R,{type:"submit",variant:"contained",color:"primary",children:"Spara"})]}),e.jsx(Y,{variant:"h4",color:"primary",children:o?"Redigera dokument":"L채gg till dokument"})]}),renderBottomContent:()=>o&&e.jsx(w,{children:e.jsx(ee,{tabs:[{id:"references",label:"Referenser",content:e.jsx(ae,{data:x,getRowId:t=>`${t.documentId}-${t.entityType}-${t.entityId}`,state:{isLoading:b},columns:[{accessorKey:"entityType",header:"Typ",enableEditing:!1,Cell:({row:t})=>A(t.original.entityType)},{accessorKey:"entityId",header:"L채nk",enableEditing:!1,Cell:({row:t})=>K(t.original.entityType,t.original.entityId)}],renderEditRowDialogContent:({row:t,table:n})=>e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"h4",color:"primary",children:n.getState().creatingRow?"Ny referens":"Redigera referens"}),e.jsx(J,{children:e.jsx(ge,{sx:{mt:1},formProps:{defaultValues:{...t.original,documentId:o.documentId}},onChange:y=>{t._valuesCache=y}})}),e.jsx(X,{children:e.jsx(Z,{row:t,table:n,variant:"text"})})]}),onCreate:t=>D(t),onUpdate:(t,n)=>v({row:t,where:n}),onDelete:t=>i(t)})}]})})})};export{Le as default};
