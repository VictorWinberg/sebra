import{r as p,j as s,g as x,L as D,h as b,i as h,k as I,B as j,T as C,l as y}from"./index-DFA1-aob.js";import{D as L}from"./DataTable-DKOnhi1J.js";import{S as F}from"./SebraDialog-BA8LCyr1.js";import{f as g,t as R}from"./date-BDFtmjFv.js";import{t as A,i as v,F as k}from"./useSnackbar-CCfpnRuD.js";import{u as S,a as T,b as M,c as E,d as w,D as B}from"./DocumentForm-BzInurTG.js";import{u as N,I as V}from"./useInteractionsQueries-w9YxZ9fQ.js";import{C as $}from"./ContentTabs-CXVeSNbl.js";import{F as K}from"./FlexGrow-CWXYGkRy.js";import{u as H,a as P,b as U,A as G}from"./useAssignmentsMutations-WxSVCsCA.js";import{a as q}from"./useAssignmentsQueries-g1VYE8zM.js";import"./useQueryParam-ZH59eNdE.js";import"./Tooltip-Sh9O8kPd.js";import"./MoreHoriz-Cfj3PZ_4.js";import"./index.esm-FWDVyD6a.js";import"./useContactsQueries-rcfqKxji.js";import"./useCompaniesQueries-B4_0YUS1.js";const z=({defaultValues:i})=>{const{data:o=[],isLoading:n}=S(i),{data:r=[],isLoading:d}=T(),l=p.useMemo(()=>{const e=A(r,"documentId");return o.map(t=>e.get(t.documentId)).filter(t=>!!t)},[r,o]),{mutate:c}=M(),{mutate:m}=E(),{mutate:u}=w();return s.jsx(L,{data:l,getRowId:e=>e.documentId,state:{isLoading:d||n},columns:[{accessorKey:"documentName",header:"Dokumentnamn",Cell:({cell:e,row:t})=>s.jsx(x,{component:D,to:`/documents/${t.original.documentId}`,children:e.getValue()})},{accessorKey:"content.type",accessorFn:e=>{var t;return(t=e.content)==null?void 0:t.type},header:"Filtyp",enableEditing:!1},{accessorKey:"content.lastModified",accessorFn:e=>{var t;return b((t=e.content)==null?void 0:t.lastModified)},header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>g(R(e.getValue()))}],renderEditRowDialogContent:({row:e,table:t})=>s.jsx(F,{table:t,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:B}),onCreate:e=>c(e,{onSuccess:t=>m({...i,documentId:t})}),onUpdate:e=>c(e),onDelete:e=>u(e)})},me=()=>{const i=h(),o=I(),{data:n,isLoading:r}=q(i.id==="new"?void 0:Number(i.id)),{mutate:d}=H(),{mutate:l}=P(),{mutate:c}=U(),{data:m=[],isLoading:u}=N(),e=p.useMemo(()=>m.filter(a=>v(a.contacts,(n==null?void 0:n.responsibleContacts)||[],"contactId").length>0),[m,n]),t=a=>{n?l(a):d(a,{onSuccess:f=>o(`/home/assignments/${f.assignmentId}`)})};if(!r)return s.jsx(G,{formProps:{values:n},onSubmit:t,renderTopContent:()=>s.jsxs(j,{sx:{position:"relative",mt:1,mb:3},children:[s.jsx(C,{variant:"h4",color:"primary",children:n?"Redigera uppdrag":"LÃ¤gg till uppdrag"}),s.jsx(k,{sx:{position:"absolute",top:0,right:0},onDelete:n?()=>c(n,{onSuccess:()=>o("..")}):void 0,onCancel:()=>o(-1)})]}),renderBottomContent:()=>n&&s.jsx(K,{sx:{mt:1,minHeight:`calc(100vh - ${y}px - 1rem)`},children:s.jsx($,{tabs:[{id:"interactions",label:"Interaktioner",content:s.jsx(V,{interactions:e,isLoading:u,defaultValues:{contacts:[...n.responsibleContacts,n.externalContact].filter(a=>!!a),interactionDate:g()}})},{id:"documents",label:"Dokument",content:s.jsx(z,{defaultValues:{entityId:n.assignmentId,entityType:"assignment"}})},{id:"stakeholders",label:"Intressenter",content:s.jsx(s.Fragment,{children:"Intressenter..."})},{id:"modules",label:"Moduler",content:s.jsx(s.Fragment,{children:"Moduler..."})}]})})})};export{me as default};
