import{r as p,j as s,h as D,L as x,i as b,k as h,l as C,B as j,T as y,F as I,m as L}from"./index-L1L35c__.js";import{D as R}from"./DataTable-5WJgMj7Y.js";import{S as A}from"./SebraDialog-CfxupOjU.js";import{f as g,t as v}from"./date-CwZn5mgt.js";import{t as F,i as S,F as T}from"./useSnackbar-DZ6xs5-N.js";import{u as k,a as E,b as M,c as w,d as B,D as V}from"./DocumentForm-CO4n_yhw.js";import{u as $,I as K}from"./useInteractionsQueries-BqmhuMr3.js";import{C as N}from"./ContentTabs-sWF0dolc.js";import{u as H,a as P,b as U,A as G}from"./useAssignmentsMutations-0cbX5wjP.js";import{a as q}from"./useAssignmentsQueries-Bbd2EWdx.js";import"./useQueryParam-ehg0XFZT.js";import"./Tooltip-DsDj3qVP.js";import"./MoreHoriz-y-vap74H.js";import"./index.esm-Dqgv-uXP.js";import"./Tabs-BtPJqpS7.js";import"./useContactsQueries-Cwh-UZ5n.js";import"./useCompaniesQueries-Q_w3bqQq.js";const z=({defaultValues:i})=>{const{data:o=[],isLoading:n}=k(i),{data:r=[],isLoading:d}=E(),u=p.useMemo(()=>{const e=F(r,"documentId");return o.map(t=>e.get(t.documentId)).filter(t=>!!t)},[r,o]),{mutate:c}=M(),{mutate:m}=w(),{mutate:l}=B();return s.jsx(R,{data:u,getRowId:e=>e.documentId,state:{isLoading:d||n},columns:[{accessorKey:"documentName",header:"Dokumentnamn",Cell:({cell:e,row:t})=>s.jsx(D,{component:x,to:`/documents/${t.original.documentId}`,children:e.getValue()})},{accessorKey:"content.type",accessorFn:e=>{var t;return(t=e.content)==null?void 0:t.type},header:"Filtyp",enableEditing:!1},{accessorKey:"content.lastModified",accessorFn:e=>{var t;return b((t=e.content)==null?void 0:t.lastModified)},header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>g(v(e.getValue()))}],renderEditRowDialogContent:({row:e,table:t})=>s.jsx(A,{table:t,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:V}),onCreate:e=>c(e,{onSuccess:t=>m({...i,documentId:t})}),onUpdate:e=>c(e),onDelete:e=>l(e)})},me=()=>{const i=h(),o=C(),{data:n,isLoading:r}=q(i.id==="new"?void 0:i.id),{mutate:d}=H(),{mutate:u}=P(),{mutate:c}=U(),{data:m=[],isLoading:l}=$(),e=p.useMemo(()=>m.filter(a=>S(a.contacts,(n==null?void 0:n.responsibleContacts)||[],"id").length>0),[m,n]),t=a=>{n?u(a):d(a,{onSuccess:f=>o(`/home/assignments/${f.id}`)})};if(!r)return s.jsx(G,{formProps:{values:n},onSubmit:t,renderTopContent:()=>s.jsxs(j,{sx:{position:"relative",mt:1,mb:3},children:[s.jsx(y,{variant:"h4",color:"primary",children:n?"Redigera uppdrag":"LÃ¤gg till uppdrag"}),s.jsx(T,{sx:{position:"absolute",top:0,right:0},onDelete:n?()=>c(n,{onSuccess:()=>o("..")}):void 0,onCancel:()=>o(-1)})]}),renderBottomContent:()=>n&&s.jsx(I,{sx:{mt:1,minHeight:`calc(100vh - ${L}px - 1rem)`},children:s.jsx(N,{tabs:[{id:"interactions",label:"Interaktioner",content:s.jsx(K,{interactions:e,isLoading:l,defaultValues:{contacts:[...n.responsibleContacts,n.externalContact].filter(a=>!!a),interactionDate:g()}})},{id:"documents",label:"Dokument",content:s.jsx(z,{defaultValues:{entityId:n.id,entityType:"assignment"}})}]})})})};export{me as default};
