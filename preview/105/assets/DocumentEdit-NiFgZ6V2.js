import{r as y,j as e,G as h,X as _,Y as B,Z as A,A as K,k as P,g as U,B as V,T as G,F as O,L as x,_ as Y}from"./index-Ab0S3KPw.js";import{u as R}from"./useAssignmentsQueries-Blz2fyRU.js";import{u as S}from"./useCompaniesQueries-liN-YQV_.js";import{u as w}from"./useContactsQueries-RFGGS855.js";import{C as q}from"./ContentTabs-CljxWgFG.js";import{D as W}from"./DataTable-DCmVd4xV.js";import{S as X}from"./SebraDialog-BZZ8l51r.js";import{S as Z,A as z,t as D,F as H}from"./SebraForm-BzoczKso.js";import{f as J,b as Q,e as ee,u as te,c as ne,g as ae,d as se,D as oe}from"./DocumentForm-DELopPhk.js";import{u as re,C as I}from"./index.esm-9NeY-HiQ.js";import{M as L}from"./MoreHoriz-D5K2rj0f.js";import{L as j}from"./Link-C_tEwhBP.js";import"./useQueryParam-D6b-Itm4.js";import"./Tabs-D4Wsyrfu.js";import"./Tooltip-BNzdjh9z.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new s.Error().stack;c&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[c]="24fa73b1-b984-44aa-ba08-26820089ccff",s._sentryDebugIdIdentifier="sentry-dbid-24fa73b1-b984-44aa-ba08-26820089ccff")}catch{}})();const ce=[{label:"Bolag",value:"company"},{label:"Kontakt",value:"contact"},{label:"Uppdrag",value:"assignment"}],ie=({formProps:s,...c})=>{const{data:r=[]}=w(),{data:i=[]}=R(),{data:m=[]}=S(),{control:u,handleSubmit:d,watch:l,formState:{errors:p}}=re(s),f=l(),g=y.useMemo(()=>{switch(f.entityType){case"company":return m.map(n=>({id:n.id,label:n.companyName}));case"contact":return r.map(n=>({id:n.id,label:n.contactName}));case"assignment":return i.map(n=>({id:n.id,label:n.assignmentName}));default:return[]}},[f.entityType,m,r,i]);return e.jsx(Z,{...c,handleSubmit:d,children:e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(_,{fullWidth:!0,variant:"outlined",error:!!p.entityType,children:[e.jsx(B,{children:"Typ"}),e.jsx(I,{control:u,name:"entityType",defaultValue:"",rules:{required:!0},render:({field:n})=>e.jsxs(A,{label:"Typ",...n,children:[e.jsx(L,{value:"",disabled:!0,children:"V채lj typ"}),ce.map(a=>e.jsx(L,{value:a.value,children:a.label},a.value))]})})]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(I,{name:"entityId",control:u,rules:{required:!0},render:({field:n})=>e.jsx(z,{options:g,getOptionKey:a=>a.id,getOptionLabel:a=>a.label,value:g.find(a=>a.id===n.value)||null,onChange:(a,b)=>n.onChange(b?b.id:void 0),renderInput:a=>e.jsx(K,{...a,label:"L채nk",variant:"outlined",fullWidth:!0})})})})]})})},Ce=()=>{const s=P(),c=U(),{data:r,isLoading:i}=J(s.id==="new"?void 0:s.id),{mutate:m}=Q(),{mutate:u}=ee(),{data:d=[]}=S(),{data:l=[]}=w(),{data:p=[]}=R(),{data:f=[],isLoading:g}=te(s.id!=="new"?{documentId:s.id}:void 0),{mutate:n}=ne(),{mutate:a}=ae(),{mutate:b}=se(),k=y.useMemo(()=>D(d,"id"),[d]),F=y.useMemo(()=>D(l,"id"),[l]),M=y.useMemo(()=>D(p,"id"),[p]),E=t=>{m(t,{onSuccess:o=>c(`/documents/${o}`)})};if(i)return;const N=t=>{switch(t){case"company":return"Bolag";case"contact":return"Kontakt";case"assignment":return"Uppdrag";default:return null}},$=(t,o)=>{var v,T,C;switch(t){case"company":return e.jsx(j,{component:x,to:`/home/companies/${o}`,children:(v=k.get(o))==null?void 0:v.companyName});case"contact":return e.jsx(j,{component:x,to:`/home/contacts/${o}`,children:(T=F.get(o))==null?void 0:T.contactName});case"assignment":return e.jsx(j,{component:x,to:{pathname:`/home/assignments/${o}`,search:`${Y({tab:"documents"})}`},children:(C=M.get(o))==null?void 0:C.assignmentName});default:return null}};return e.jsx(oe,{formProps:{defaultValues:r},onSubmit:E,renderTopContent:()=>e.jsxs(V,{sx:{position:"relative",mt:1,mb:3},children:[e.jsx(G,{variant:"h4",color:"primary",children:r?"Redigera dokument":"L채gg till dokument"}),e.jsx(H,{sx:{position:"absolute",top:0,right:0},onDelete:r?()=>u(r,{onSuccess:()=>c("..")}):void 0,onCancel:()=>c(-1)})]}),renderBottomContent:()=>r&&e.jsx(O,{children:e.jsx(q,{tabs:[{id:"references",label:"Referenser",content:e.jsx(W,{data:f,getRowId:t=>`${t.documentId}-${t.entityType}-${t.entityId}`,state:{isLoading:g},columns:[{accessorKey:"entityType",header:"Typ",enableEditing:!1,Cell:({row:t})=>N(t.original.entityType)},{accessorKey:"entityId",header:"L채nk",enableEditing:!1,Cell:({row:t})=>$(t.original.entityType,t.original.entityId)}],renderEditRowDialogContent:({row:t,table:o})=>e.jsx(X,{table:o,row:t,titles:{creating:"Ny referens",editing:"Redigera referens"},FormComponent:ie,defaultValues:{documentId:r.documentId}}),onCreate:t=>n(t),onUpdate:(t,o)=>a({row:t,where:o}),onDelete:t=>b(t)})}]})})})};export{Ce as default};
//# sourceMappingURL=DocumentEdit-NiFgZ6V2.js.map
