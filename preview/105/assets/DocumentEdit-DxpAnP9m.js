import{r as b,j as e,G as h,X as _,Y as B,Z as A,A as K,k as P,g as U,B as V,T as G,F as O,L as x,_ as Y}from"./index-DqpsNWba.js";import{u as R}from"./useAssignmentsQueries-CNIDoUmh.js";import{u as S}from"./useCompaniesQueries-C14D3uoL.js";import{u as w}from"./useContactsQueries-Yz6NlWBy.js";import{C as q}from"./ContentTabs-Ch28S_RQ.js";import{D as W}from"./DataTable-BZXH33yD.js";import{S as X}from"./SebraDialog-CpiV4pQs.js";import{S as Z,A as z,t as D,F as H}from"./SebraForm-B-ZBgyul.js";import{f as J,b as Q,e as ee,u as te,c as ne,g as ae,d as se,D as oe}from"./DocumentForm-DbMCni2W.js";import{u as re,C as I}from"./index.esm-CcQA5EgO.js";import{M as L}from"./MoreHoriz-BPv6rlEJ.js";import{L as j}from"./Link-pVYhQrqy.js";import"./useQueryParam-BX1NA50p.js";import"./Tabs-DXXcGlm_.js";import"./Tooltip-DK24uI3d.js";import"./FormControlLabel-B1TyRaKV.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new s.Error().stack;i&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[i]="578288c4-4972-4d2c-8ba3-05e4a4bfa72a",s._sentryDebugIdIdentifier="sentry-dbid-578288c4-4972-4d2c-8ba3-05e4a4bfa72a")}catch{}})();const ie=[{label:"Bolag",value:"company"},{label:"Kontakt",value:"contact"},{label:"Uppdrag",value:"assignment"}],ce=({formProps:s,...i})=>{const{data:r=[]}=w(),{data:c=[]}=R(),{data:m=[]}=S(),{control:u,handleSubmit:d,watch:l,formState:{errors:p}}=re(s),f=l(),g=b.useMemo(()=>{switch(f.entityType){case"company":return m.map(n=>({id:n.id,label:n.companyName}));case"contact":return r.map(n=>({id:n.id,label:n.contactName}));case"assignment":return c.map(n=>({id:n.id,label:n.assignmentName}));default:return[]}},[f.entityType,m,r,c]);return e.jsx(Z,{...i,handleSubmit:d,children:e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(_,{fullWidth:!0,variant:"outlined",error:!!p.entityType,children:[e.jsx(B,{children:"Typ"}),e.jsx(I,{control:u,name:"entityType",defaultValue:"",rules:{required:!0},render:({field:n})=>e.jsxs(A,{label:"Typ",...n,children:[e.jsx(L,{value:"",disabled:!0,children:"V채lj typ"}),ie.map(a=>e.jsx(L,{value:a.value,children:a.label},a.value))]})})]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(I,{name:"entityId",control:u,rules:{required:!0},render:({field:n})=>e.jsx(z,{options:g,getOptionKey:a=>a.id,getOptionLabel:a=>a.label,value:g.find(a=>a.id===n.value)||null,onChange:(a,y)=>n.onChange(y?y.id:void 0),renderInput:a=>e.jsx(K,{...a,label:"L채nk",variant:"outlined",fullWidth:!0})})})})]})})},Ie=()=>{const s=P(),i=U(),{data:r,isLoading:c}=J(s.id==="new"?void 0:s.id),{mutate:m}=Q(),{mutate:u}=ee(),{data:d=[]}=S(),{data:l=[]}=w(),{data:p=[]}=R(),{data:f=[],isLoading:g}=te(s.id!=="new"?{documentId:s.id}:void 0),{mutate:n}=ne(),{mutate:a}=ae(),{mutate:y}=se(),k=b.useMemo(()=>D(d,"id"),[d]),F=b.useMemo(()=>D(l,"id"),[l]),M=b.useMemo(()=>D(p,"id"),[p]),E=t=>{m(t,{onSuccess:o=>i(`/documents/${o}`)})};if(c)return;const N=t=>{switch(t){case"company":return"Bolag";case"contact":return"Kontakt";case"assignment":return"Uppdrag";default:return null}},$=(t,o)=>{var v,T,C;switch(t){case"company":return e.jsx(j,{component:x,to:`/home/companies/${o}`,children:(v=k.get(o))==null?void 0:v.companyName});case"contact":return e.jsx(j,{component:x,to:`/home/contacts/${o}`,children:(T=F.get(o))==null?void 0:T.contactName});case"assignment":return e.jsx(j,{component:x,to:{pathname:`/home/assignments/${o}`,search:`${Y({tab:"documents"})}`},children:(C=M.get(o))==null?void 0:C.assignmentName});default:return null}};return e.jsx(oe,{formProps:{defaultValues:r},onSubmit:E,renderTopContent:()=>e.jsxs(V,{sx:{position:"relative",mt:1,mb:3},children:[e.jsx(G,{variant:"h4",color:"primary",children:r?"Redigera dokument":"L채gg till dokument"}),e.jsx(H,{sx:{position:"absolute",top:0,right:0},onDelete:r?()=>u(r,{onSuccess:()=>i("..")}):void 0,onCancel:()=>i(-1)})]}),renderBottomContent:()=>r&&e.jsx(O,{children:e.jsx(q,{tabs:[{id:"references",label:"Referenser",content:e.jsx(W,{data:f,getRowId:t=>`${t.documentId}-${t.entityType}-${t.entityId}`,state:{isLoading:g},columns:[{accessorKey:"entityType",header:"Typ",enableEditing:!1,Cell:({row:t})=>N(t.original.entityType)},{accessorKey:"entityId",header:"L채nk",enableEditing:!1,Cell:({row:t})=>$(t.original.entityType,t.original.entityId)}],renderEditRowDialogContent:({row:t,table:o})=>e.jsx(X,{table:o,row:t,titles:{creating:"Ny referens",editing:"Redigera referens"},FormComponent:ce,defaultValues:{documentId:r.documentId}}),onCreate:t=>n(t),onUpdate:(t,o)=>a({row:t,where:o}),onDelete:t=>y(t)})}]})})})};export{Ie as default};
//# sourceMappingURL=DocumentEdit-DxpAnP9m.js.map
