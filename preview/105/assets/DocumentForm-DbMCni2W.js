import{W as E,j as n,$ as W,m as _,o as L,x as p,y as x,z as w,a0 as Q,a1 as K,I as j,a2 as P,a3 as U,h as F,r as y,B as I,u as H,G as h,A as g,a4 as T}from"./index-DqpsNWba.js";import{u as B,C as D}from"./index.esm-CcQA5EgO.js";import{v as N,p as S,S as O,A as z}from"./SebraForm-B-ZBgyul.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="fc1efd8a-6a7b-47cc-ae12-0c6b0ee17e20",e._sentryDebugIdIdentifier="sentry-dbid-fc1efd8a-6a7b-47cc-ae12-0c6b0ee17e20")}catch{}})();const A=E(n.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload"),M=E(n.jsx("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload"),V=async e=>await W("document_references",e),q=async e=>{N(e,["documentId","entityType","entityId"]),await _("document_references",S(e,["documentId","entityType","entityId"]))},$=async({row:e,where:t})=>{await k(t),await q(e)},k=async e=>{await L("document_references",S(e,["documentId","entityType","entityId"]))},oe=()=>{const e=p(),{showSnackbar:t}=x();return w({mutationFn:Q,onSuccess:()=>{e.invalidateQueries({queryKey:["documents"]}),t("Dokumentet sparat!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle sparas.","error")}})},se=()=>{const e=p(),{showSnackbar:t}=x();return w({mutationFn:r=>Promise.all([K(r),k(r)]),onSuccess:()=>{e.invalidateQueries({queryKey:["documents"]}),e.invalidateQueries({queryKey:["document_references"]}),t("Dokumentet borttaget!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle tas bort.","error")}})},ce=()=>{const e=p(),{showSnackbar:t}=x();return w({mutationFn:q,onSuccess:()=>{e.invalidateQueries({queryKey:["document_references"]}),t("Dokument skapat!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle skapas.","error")}})},ae=()=>{const e=p(),{showSnackbar:t}=x();return w({mutationFn:$,onSuccess:()=>{e.invalidateQueries({queryKey:["document_references"]}),t("Dokument uppdaterat!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle uppdateras.","error")}})},ue=()=>{const e=p(),{showSnackbar:t}=x();return w({mutationFn:k,onSuccess:()=>{e.invalidateQueries({queryKey:["document_references"]}),t("Dokument borttaget!")},onError:()=>{t("Ett fel uppstod när dokumentet skulle tas bort.","error")}})},G=()=>j({queryKey:["documents"],queryFn:P}),ie=e=>j({queryKey:["documents",e],queryFn:()=>U(e),enabled:!!e}),de=e=>j({queryKey:["document_references",e],queryFn:()=>V(e),enabled:e&&Object.keys(e).length>0}),Y=({onChange:e,children:t,...r})=>{const u=c=>{var f;const d=(f=c.target.files)==null?void 0:f[0];d&&(e==null||e(d))};return n.jsxs(F,{component:"label",role:void 0,variant:"contained",tabIndex:-1,startIcon:n.jsx(M,{}),...r,children:[t,n.jsx("input",{type:"file",style:{display:"none"},onChange:u})]})};function X(){const[e,t]=y.useState([window.innerWidth,window.innerHeight]);return y.useEffect(()=>{const r=J(()=>{t([window.innerWidth,window.innerHeight])},200);return window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),e}const J=(e,t)=>{let r;return(...u)=>{let c;return clearTimeout(r),r=setTimeout(()=>{c=e(...u)},t),c}},Z=["application/pdf","application/json","image/*","text/*","video/*","audio/*"],ee=({file:e})=>{const t=X(),r=y.useRef(null),[u,c]=y.useState();if(y.useEffect(()=>{e&&Z.some(i=>e.type.match(i))?c(URL.createObjectURL(e)):c(void 0)},[e]),!e||!u)return null;const d=()=>{if(r.current&&r.current.contentWindow){const i=r.current,b=r.current.contentWindow.document,a=i.clientHeight,v=i.clientWidth,s=b.documentElement.scrollHeight,o=b.documentElement.scrollWidth,m=v/o,C=a/s,R=Math.min(m,C);i.style.transform=`scale(${R})`,i.style.transformOrigin="top left",i.style.width=`${o}px`,i.style.height=`${s}px`}},f=()=>e.type.startsWith("image/")?n.jsx("img",{src:u,alt:"Preview",style:{width:"100%",height:"100%",maxHeight:"33vh",objectFit:"cover"}}):n.jsx("iframe",{ref:r,src:u,title:"Preview",onLoad:d,style:{width:"100%",height:"33vh",border:"none"}},`${t}`);return n.jsx(I,{sx:{mx:-1,overflow:"hidden"},children:n.jsx(I,{sx:{width:"100%",height:"33vh",px:1},children:f()},u)})},le=({formProps:e,...t})=>{const u=!H().pathname.startsWith("/documents"),{data:c=[]}=G(),{control:d,handleSubmit:f,watch:i,setValue:l,formState:{errors:b}}=B(e),a=i(),v=s=>{l("documentName",s.name),l("content",s)};return y.useEffect(()=>{if(a.documentId){const s=c.find(o=>o.documentId===a.documentId);s&&(l("documentName",s.documentName),l("content",s.content))}else l("documentName",""),l("content",void 0)},[a.documentId,l,c]),n.jsx(O,{...t,handleSubmit:f,children:n.jsxs(h,{container:!0,spacing:2,children:[n.jsx(h,{item:!0,xs:12,sm:6,children:n.jsx(D,{control:d,name:"documentName",rules:{required:!0},defaultValue:"",render:({field:s,fieldState:o})=>n.jsx(g,{fullWidth:!0,label:"Dokumentnamn",type:"text",margin:"none",...s,error:!!o.error})})}),n.jsx(h,{item:!0,xs:12,sm:6,children:n.jsx(D,{control:d,name:"content",rules:{required:!0},render:({field:s})=>{var o,m;return n.jsx(g,{fullWidth:!0,label:"Dokument",type:"text",margin:"none",value:((o=s.value)==null?void 0:o.name)||"",disabled:!0,error:!!b.content,InputProps:{endAdornment:(m=a.content)==null?void 0:m.type}})}})}),n.jsx(h,{item:!0,xs:12,children:n.jsx(ee,{file:a.content})}),n.jsx(h,{item:!0,xs:12,children:n.jsxs(T,{spacing:2,direction:"row",children:[n.jsx(Y,{onChange:v,children:a.content?"Ersätt dokument":"Välj dokument"}),n.jsx(F,{startIcon:n.jsx(A,{}),variant:"contained",href:a.content?URL.createObjectURL(a.content):"#",download:a.documentName,disabled:!a.content,children:"Ladda ner"})]})}),n.jsx(h,{item:!0,xs:12,children:u&&n.jsx(D,{name:"documentId",control:d,render:({field:s})=>n.jsx(z,{options:c,getOptionKey:o=>o.documentId,getOptionLabel:o=>o.documentName,value:c.find(o=>o.documentId===s.value)||null,onChange:(o,m)=>s.onChange(m?m.documentId:void 0),renderInput:o=>n.jsx(g,{...o,label:"Välj existerande dokument",variant:"outlined",fullWidth:!0})})})})]})})};export{le as D,G as a,oe as b,ce as c,ue as d,se as e,ie as f,ae as g,de as u};
//# sourceMappingURL=DocumentForm-DbMCni2W.js.map
