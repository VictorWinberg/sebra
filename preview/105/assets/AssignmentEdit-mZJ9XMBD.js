import{r as f,j as o,L as b,i as D,k as y,g as x,B as h,T as I,F as C,l as j}from"./index-BIIVJD9F.js";import{D as L}from"./DataTable-C-vyMROp.js";import{S as R}from"./SebraDialog-BJFHMqdi.js";import{f as g,t as v}from"./date-BYB5fUAZ.js";import{t as F,i as k,F as w}from"./SebraForm-C2U723kH.js";import{u as S,a as T,b as A,c as E,d as M,D as B}from"./DocumentForm-B9AULJFS.js";import{L as V}from"./Link-Dz7lkQql.js";import{u as _,I as $}from"./useInteractionsQueries-C-uBVUB9.js";import{C as K}from"./ContentTabs-CKZ0JKDG.js";import{u as N,a as H,b as P,A as U}from"./useAssignmentsMutations-Bx7SEyul.js";import{a as G}from"./useAssignmentsQueries-BpGwHrGl.js";import"./useQueryParam-gbZkr1TB.js";import"./Tooltip-BSr2dNXR.js";import"./MoreHoriz-DYSJiGGp.js";import"./index.esm-rJOtjnYk.js";import"./Tabs-Djse8mhj.js";import"./useContactsQueries-F0B5QZNC.js";import"./useCompaniesQueries-B-gHFO6e.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new s.Error().stack;a&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[a]="75abf508-8d03-4562-8d2e-9716397d3cb5",s._sentryDebugIdIdentifier="sentry-dbid-75abf508-8d03-4562-8d2e-9716397d3cb5")}catch{}})();const q=({defaultValues:s})=>{const{data:a=[],isLoading:t}=S(s),{data:r=[],isLoading:m}=T(),u=f.useMemo(()=>{const e=F(r,"documentId");return a.map(n=>e.get(n.documentId)).filter(n=>!!n)},[r,a]),{mutate:c}=A(),{mutate:d}=E(),{mutate:l}=M();return o.jsx(L,{data:u,getRowId:e=>e.documentId,state:{isLoading:m||t},columns:[{accessorKey:"documentName",header:"Dokumentnamn",Cell:({cell:e,row:n})=>o.jsx(V,{component:b,to:`/documents/${n.original.documentId}`,children:e.getValue()})},{accessorKey:"content.type",accessorFn:e=>{var n;return(n=e.content)==null?void 0:n.type},header:"Filtyp",enableEditing:!1},{accessorKey:"content.lastModified",accessorFn:e=>{var n;return D((n=e.content)==null?void 0:n.lastModified)},header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>g(v(e.getValue()))}],renderEditRowDialogContent:({row:e,table:n})=>o.jsx(R,{table:n,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:B}),onCreate:e=>c(e,{onSuccess:n=>d({...s,documentId:n})}),onUpdate:e=>c(e),onDelete:e=>l(e)})},me=()=>{const s=y(),a=x(),{data:t,isLoading:r}=G(s.id==="new"?void 0:s.id),{mutate:m}=N(),{mutate:u}=H(),{mutate:c}=P(),{data:d=[],isLoading:l}=_(),e=f.useMemo(()=>d.filter(i=>k(i.contacts||[],(t==null?void 0:t.responsibleContacts)||[],"id").length>0),[d,t]),n=i=>{t?u({...i,id:t.id}):m(i,{onSuccess:({createAssignment:p})=>a(`/home/assignments/${(p==null?void 0:p.id)||""}`)})};if(!r)return o.jsx(U,{formProps:{values:t},onSubmit:n,renderTopContent:()=>o.jsxs(h,{sx:{position:"relative",mt:1,mb:3},children:[o.jsx(I,{variant:"h4",color:"primary",children:t?"Redigera uppdrag":"LÃ¤gg till uppdrag"}),o.jsx(w,{sx:{position:"absolute",top:0,right:0},onDelete:t?()=>c(t,{onSuccess:()=>a("..")}):void 0,onCancel:()=>a(-1)})]}),renderBottomContent:()=>t&&o.jsx(C,{sx:{mt:1,minHeight:`calc(100vh - ${j}px - 1rem)`},children:o.jsx(K,{tabs:[{id:"interactions",label:"Interaktioner",content:o.jsx($,{interactions:e,isLoading:l,defaultValues:{contacts:[...t.responsibleContacts||[],t.externalContact].filter(i=>!!i),interactionDate:g()}})},{id:"documents",label:"Dokument",content:o.jsx(q,{defaultValues:{entityId:t.id,entityType:"assignment"}})}]})})})};export{me as default};
//# sourceMappingURL=AssignmentEdit-mZJ9XMBD.js.map
