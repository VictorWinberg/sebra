import{r as g,j as e,G as h,a3 as K,a4 as U,a5 as A,a6 as R,Q as P,c as V,a as q,E as x,B as G,T as O,F as W,a7 as Y}from"./index-7FIy1zDU.js";import{u as L}from"./useAssignmentsQueries-BXSIJDbB.js";import{u as w}from"./useCompaniesQueries-Bw-JPAlm.js";import{u as k}from"./useContactsQueries-CoiifGNo.js";import{C as Q}from"./ContentTabs-D-nDdmzy.js";import{D as z}from"./DataTable-B7sNTyOg.js";import{S as H,A as J,F as X,R as D}from"./RouterLink-SXrpXvGb.js";import{S as Z}from"./SebraDialog-CMEArWHD.js";import{g as ee,a as te,b as ne,f as ae,u as se,c as oe,h as re,d as ce,D as ie}from"./DocumentForm-DycN8pQA.js";import{u as ue,C as S}from"./index.esm-D_XmXi7e.js";import{L as j}from"./Link-CphrlDwH.js";import"./useQueryParam-BFvmcfsc.js";import"./Tabs-LjgcW6mv.js";import"./Tooltip-C3Pc4GL9.js";import"./MoreHoriz-BYq6CRXO.js";import"./createStyled-JkiGtY9a.js";import"./FormControlLabel-Czx2BUCM.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},i=new s.Error().stack;i&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[i]="082df9d8-10f6-4c73-bc52-cb18b95bacdb",s._sentryDebugIdIdentifier="sentry-dbid-082df9d8-10f6-4c73-bc52-cb18b95bacdb")}catch{}})();const me=[{label:"Bolag",value:"company"},{label:"Kontakt",value:"contact"},{label:"Uppdrag",value:"assignment"}],de=({formProps:s,...i})=>{const{data:c=[]}=k(),{data:o=[]}=L(),{data:d=[]}=w(),{control:l,handleSubmit:b,watch:y,formState:{errors:p}}=ue(s),u=y(),m=g.useMemo(()=>{switch(u.entityType){case"company":return d.map(n=>({id:n.id,label:n.companyName}));case"contact":return c.map(n=>({id:n.id,label:n.contactName}));case"assignment":return o.map(n=>({id:n.id,label:n.assignmentName}));default:return[]}},[u.entityType,d,c,o]);return e.jsx(H,{...i,handleSubmit:b,children:e.jsxs(h,{container:!0,spacing:2,children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsxs(K,{fullWidth:!0,variant:"outlined",error:!!p.entityType,children:[e.jsx(U,{children:"Typ"}),e.jsx(S,{control:l,name:"entityType",defaultValue:"",rules:{required:!0},render:({field:n})=>e.jsxs(A,{label:"Typ",...n,children:[e.jsx(R,{value:"",disabled:!0,children:"V채lj typ"}),me.map(a=>e.jsx(R,{value:a.value,children:a.label},a.value))]})})]})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(S,{name:"entityId",control:l,rules:{required:!0},render:({field:n})=>e.jsx(J,{options:m,getOptionKey:a=>a.id,getOptionLabel:a=>a.label,value:m.find(a=>a.id===n.value)||null,onChange:(a,f)=>n.onChange(f?f.id:void 0),renderInput:a=>e.jsx(P,{...a,label:"L채nk",variant:"outlined",fullWidth:!0})})})})]})})},ke=()=>{const{id:s,workspace:i}=V(),c=q(),{data:o,isLoading:d}=ee(s==="new"?void 0:s),{mutate:l}=te(),{mutate:b}=ne(),{mutate:y}=ae(),{data:p=[]}=w(),{data:u=[]}=k(),{data:m=[]}=L(),{data:n=[],isLoading:a}=se(s!=="new"?{document:{equals:s}}:void 0),{mutate:f}=oe(),{mutate:F}=re(),{mutate:E}=ce(),I=g.useMemo(()=>x(p,"id"),[p]),M=g.useMemo(()=>x(u,"id"),[u]),N=g.useMemo(()=>x(m,"id"),[m]),$=t=>{o?b({...t,id:o.id}):l(t,{onSuccess:r=>c(`/${i}/documents/${r.doc.id}`)})};if(d)return;const B=t=>{switch(t){case"company":return"Bolag";case"contact":return"Kontakt";case"assignment":return"Uppdrag";default:return null}},_=(t,r)=>{var v,T,C;switch(t){case"company":return e.jsx(j,{component:D,to:`/home/companies/${r}`,children:(v=I.get(r))==null?void 0:v.companyName});case"contact":return e.jsx(j,{component:D,to:`/home/contacts/${r}`,children:(T=M.get(r))==null?void 0:T.contactName});case"assignment":return e.jsx(j,{component:D,to:{pathname:`/home/assignments/${r}`,search:`${Y({tab:"documents"})}`},children:(C=N.get(r))==null?void 0:C.assignmentName});default:return null}};return e.jsx(ie,{formProps:{defaultValues:{...o}},onSubmit:$,renderTopContent:()=>e.jsxs(G,{sx:{position:"relative",mt:1,mb:3},children:[e.jsx(O,{variant:"h4",color:"primary",children:o?"Redigera dokument":"L채gg till dokument"}),e.jsx(X,{sx:{position:"absolute",top:0,right:0},onDelete:o?()=>y(o,{onSuccess:()=>c("..")}):void 0,onCancel:()=>c(-1)})]}),renderBottomContent:()=>o&&e.jsx(W,{children:e.jsx(Q,{tabs:[{id:"references",label:"Referenser",content:e.jsx(z,{data:n,getRowId:t=>`${t.document}-${t.entityType}-${t.entityId}`,state:{isLoading:a},columns:[{accessorKey:"entityType",header:"Typ",enableEditing:!1,Cell:({row:t})=>B(t.original.entityType)},{accessorKey:"entityId",header:"L채nk",enableEditing:!1,Cell:({row:t})=>_(t.original.entityType,t.original.entityId)}],renderEditRowDialogContent:({row:t,table:r})=>e.jsx(Z,{table:r,row:t,titles:{creating:"Ny referens",editing:"Redigera referens"},FormComponent:de,defaultValues:{document:o}}),onCreate:t=>f(t),onUpdate:t=>F(t),onDelete:t=>E(t)})}]})})})};export{ke as default};
//# sourceMappingURL=DocumentEdit-CkZKVVVy.js.map
