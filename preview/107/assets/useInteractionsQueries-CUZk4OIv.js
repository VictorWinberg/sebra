import{n as D,v as T,o as q,p as C,q as F,s as p,t as I,w as x,j as n,G as s,x as y,i as j,r as R,C as k,d as K,e as L,L as Q,A as M,y as _}from"./index-Dl4XAGHA.js";import{D as N}from"./DataTable-KrIayMax.js";import{S as O}from"./SebraDialog-DuIQz_h4.js";import{f as w,t as A}from"./date-5MLBmrxt.js";import{p as m,t as f,u as b,S as V,D as G,A as W,a as z}from"./SebraForm-Buo_nVLS.js";import{u as P,C as h}from"./index.esm-CNmaJeLN.js";import{u as U}from"./useContactsQueries-BSwGKqDL.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new t.Error().stack;a&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[a]="c2209781-73c0-47bd-b078-d006accb11f9",t._sentryDebugIdIdentifier="sentry-dbid-c2209781-73c0-47bd-b078-d006accb11f9")}catch{}})();const $=async()=>{const a=(await p("SELECT * FROM interactions")).map(e=>({...e,contacts:[]})),i=f(a,"interactionId"),c=await p("SELECT * FROM contacts"),u=f(c,"contactId");return(await p("SELECT * FROM interaction_contacts")).forEach(e=>{const r=i.get(e.interactionId),o=u.get(e.contactId);!r||!o||r.contacts.push(o)}),Array.from(i.values())},B=async t=>{const a=await D("interactions",m({...t,interactionId:T()},["interactionId","interactionType","interactionDate","notes"]));await E({interactionId:a.interactionId,contacts:t.contacts})},H=async t=>{await q("interactions",m(t,["interactionType","interactionDate","notes"]),m(t,["interactionId"])),await X(t)},J=async t=>{await S(t),await C("interactions",m(t,["interactionId"]))},E=async t=>{await F("interaction_contacts",t.contacts.map(({contactId:a})=>({interactionId:t.interactionId,contactId:a})))},X=async t=>{await S(t),await E(t)},S=async t=>{await C("interaction_contacts",m(t,["interactionId"]))},Y=()=>{const t=I(),{showSnackbar:a}=x();return b({mutationFn:B,onSuccess:()=>{t.invalidateQueries({queryKey:["interactions"]}),a("Interaktion sparat!")},onError:()=>{a("Ett fel uppstod när interaktionen skulle sparas.","error")}})},Z=()=>{const t=I(),{showSnackbar:a}=x();return b({mutationFn:H,onSuccess:()=>{t.invalidateQueries({queryKey:["interactions"]}),a("Interaktion uppdaterat!")},onError:()=>{a("Ett fel uppstod när interaktionen skulle uppdateras.","error")}})},tt=()=>{const t=I(),{showSnackbar:a}=x();return b({mutationFn:J,onSuccess:()=>{t.invalidateQueries({queryKey:["interactions"]}),a("Interaktion borttaget!")},onError:()=>{a("Ett fel uppstod när interaktionen skulle tas bort.","error")}})},et=({formProps:t,...a})=>{const{data:i=[]}=U(),{control:c,handleSubmit:u,register:l,formState:{errors:e}}=P(t);return n.jsx(V,{...a,handleSubmit:u,children:n.jsxs(s,{container:!0,spacing:2,children:[n.jsx(s,{item:!0,xs:12,sm:6,children:n.jsxs(s,{container:!0,spacing:2,children:[n.jsx(s,{item:!0,xs:12,children:n.jsx(y,{fullWidth:!0,label:"Typ av interaktion",type:"text",margin:"none",...l("interactionType",{required:!0}),error:!!e.interactionType})}),n.jsx(s,{item:!0,xs:12,children:n.jsx(y,{multiline:!0,fullWidth:!0,minRows:4,label:"Noteringar",type:"text",margin:"none",...l("notes"),error:!!e.notes})})]})}),n.jsx(s,{item:!0,xs:12,sm:6,children:n.jsxs(s,{container:!0,spacing:2,children:[n.jsx(s,{item:!0,xs:12,children:n.jsx(h,{control:c,name:"interactionDate",rules:{required:!0},render:({field:r})=>n.jsx(G,{label:"Interaktionsdatum",value:j(r.value),inputRef:r.ref,onChange:o=>r.onChange(w(o))})})}),n.jsx(s,{item:!0,xs:12,children:n.jsx(h,{name:"contacts",control:c,render:({field:r})=>n.jsx(W,{multiple:!0,disableCloseOnSelect:!0,id:"multiple-contacts",options:i,getOptionKey:o=>o.contactId,getOptionLabel:o=>o.contactName,isOptionEqualToValue:(o,d)=>o.contactId===d.contactId,value:r.value||[],onChange:(o,d)=>r.onChange(d),renderInput:o=>n.jsx(y,{...o,label:"Kontakter",variant:"outlined",fullWidth:!0,error:!!e.contacts}),renderTags:(o,d)=>o.map((g,v)=>R.createElement(k,{...d({index:v}),key:g.contactId,label:g.contactName}))})})})]})})]})})},ut=({interactions:t,isLoading:a,defaultValues:i})=>{const{mutate:c}=Y(),{mutate:u}=Z(),{mutate:l}=tt();return n.jsx(N,{data:t,getRowId:e=>e.interactionId,state:{isLoading:a},columns:[{accessorKey:"interactionType",header:"Typ",filterVariant:"multi-select"},{accessorKey:"contacts",header:"Kontakter",minSize:150,enableEditing:!1,Cell:({cell:e})=>n.jsx(K,{disablePadding:!0,children:e.getValue().map(r=>n.jsx(L,{sx:{py:.25},disableGutters:!0,children:n.jsx(k,{component:Q,variant:"outlined",avatar:n.jsx(M,{..._(r.contactName)}),label:r.contactName,to:`/home/contacts/${r.contactId}`,clickable:!0,size:"small"})},r.contactId))})},{accessorKey:"notes",header:"Noteringar"},{accessorFn:e=>j(e.interactionDate),header:"Interaktionsdatum",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>w(A(e.getValue()))}],renderEditRowDialogContent:({row:e,table:r})=>n.jsx(O,{table:r,row:e,titles:{creating:"Ny interaktion",editing:"Redigera interaktion"},FormComponent:et,defaultValues:i}),onCreate:e=>c(e),onUpdate:e=>u(e),onDelete:e=>l(e)})},lt=()=>z({queryKey:["interactions"],queryFn:()=>$()});export{ut as I,lt as u};
//# sourceMappingURL=useInteractionsQueries-CUZk4OIv.js.map
