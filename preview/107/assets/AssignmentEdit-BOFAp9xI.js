import{r as p,j as o,h as b,L as D,i as y,k as x,l as I,B as h,T as C,F as j,m as L}from"./index-Dl4XAGHA.js";import{D as R}from"./DataTable-KrIayMax.js";import{S as v}from"./SebraDialog-DuIQz_h4.js";import{f as g,t as A}from"./date-5MLBmrxt.js";import{t as F,i as k,F as w}from"./SebraForm-Buo_nVLS.js";import{u as S,a as T,b as E,c as M,d as B,D as N}from"./DocumentForm-CtJHB8As.js";import{u as V,I as _}from"./useInteractionsQueries-CUZk4OIv.js";import{C as $}from"./ContentTabs-C3K3dZpX.js";import{u as K,a as H,b as P,A as U}from"./useAssignmentsMutations-Cr10V4cH.js";import{a as G}from"./useAssignmentsQueries-DGTiaBcs.js";import"./useQueryParam-OOHpWbWx.js";import"./Tooltip-BgxD-eQP.js";import"./MoreHoriz-DDxmLduF.js";import"./index.esm-CNmaJeLN.js";import"./Tabs-BnkWJ6vk.js";import"./useContactsQueries-BSwGKqDL.js";import"./useCompaniesQueries-D5QFk1VV.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new s.Error().stack;a&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[a]="e2559cd7-6a5c-4175-8769-e34e776a769b",s._sentryDebugIdIdentifier="sentry-dbid-e2559cd7-6a5c-4175-8769-e34e776a769b")}catch{}})();const q=({defaultValues:s})=>{const{data:a=[],isLoading:n}=S(s),{data:r=[],isLoading:d}=T(),u=p.useMemo(()=>{const e=F(r,"documentId");return a.map(t=>e.get(t.documentId)).filter(t=>!!t)},[r,a]),{mutate:c}=E(),{mutate:m}=M(),{mutate:l}=B();return o.jsx(R,{data:u,getRowId:e=>e.documentId,state:{isLoading:d||n},columns:[{accessorKey:"documentName",header:"Dokumentnamn",Cell:({cell:e,row:t})=>o.jsx(b,{component:D,to:`/documents/${t.original.documentId}`,children:e.getValue()})},{accessorKey:"content.type",accessorFn:e=>{var t;return(t=e.content)==null?void 0:t.type},header:"Filtyp",enableEditing:!1},{accessorKey:"content.lastModified",accessorFn:e=>{var t;return y((t=e.content)==null?void 0:t.lastModified)},header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>g(A(e.getValue()))}],renderEditRowDialogContent:({row:e,table:t})=>o.jsx(v,{table:t,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:N}),onCreate:e=>c(e,{onSuccess:t=>m({...s,documentId:t})}),onUpdate:e=>c(e),onDelete:e=>l(e)})},me=()=>{const s=x(),a=I(),{data:n,isLoading:r}=G(s.id==="new"?void 0:Number(s.id)),{mutate:d}=K(),{mutate:u}=H(),{mutate:c}=P(),{data:m=[],isLoading:l}=V(),e=p.useMemo(()=>m.filter(i=>k(i.contacts,(n==null?void 0:n.responsibleContacts)||[],"contactId").length>0),[m,n]),t=i=>{n?u(i):d(i,{onSuccess:f=>a(`/home/assignments/${f.assignmentId}`)})};if(!r)return o.jsx(U,{formProps:{values:n},onSubmit:t,renderTopContent:()=>o.jsxs(h,{sx:{position:"relative",mt:1,mb:3},children:[o.jsx(C,{variant:"h4",color:"primary",children:n?"Redigera uppdrag":"LÃ¤gg till uppdrag"}),o.jsx(w,{sx:{position:"absolute",top:0,right:0},onDelete:n?()=>c(n,{onSuccess:()=>a("..")}):void 0,onCancel:()=>a(-1)})]}),renderBottomContent:()=>n&&o.jsx(j,{sx:{mt:1,minHeight:`calc(100vh - ${L}px - 1rem)`},children:o.jsx($,{tabs:[{id:"interactions",label:"Interaktioner",content:o.jsx(_,{interactions:e,isLoading:l,defaultValues:{contacts:[...n.responsibleContacts,n.externalContact].filter(i=>!!i),interactionDate:g()}})},{id:"documents",label:"Dokument",content:o.jsx(q,{defaultValues:{entityId:n.assignmentId,entityType:"assignment"}})}]})})})};export{me as default};
//# sourceMappingURL=AssignmentEdit-BOFAp9xI.js.map
