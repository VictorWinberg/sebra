import{r as x,j as t,g as j,L as b,h as y,i as I,k as C,B as v,S as L,f as p,l as T,T as A,m as R}from"./index-D-ocvujd.js";import{t as k,D as S,a as F,b as M,M as E,i as $}from"./useSnackbar-FKi4dRLH.js";import{D as B,a as V}from"./DataTable-C1lTF_-n.js";import{f,t as N}from"./date-BZLFgMfh.js";import{u as P,a as w,b as H,c as U,D as _,d as G}from"./DocumentForm-JySPWz46.js";import{u as K,I as q}from"./useInteractionsQueries-CR4YHhFC.js";import{C as z}from"./ContentTabs-IvI5qtOT.js";import{F as J}from"./FlexGrow-RtNkhMTn.js";import{u as O,a as Q,b as W,A as X}from"./useAssignmentsMutations-Bk2WcfmF.js";import{a as Y}from"./useAssignmentsQueries-CG64215t.js";import"./MoreHoriz-DFlBm3TD.js";import"./index.esm-DNzt2WsN.js";import"./Tooltip-BqWSFl2W.js";import"./useQueryParam-k4YJYB-2.js";import"./useContactsQueries-nScrN7e5.js";import"./useCompaniesQueries-BR5bPGwy.js";const Z=({documentReferences:o,isLoading:i,defaultValues:n})=>{const{data:r=[],isLoading:m}=P(),d=x.useMemo(()=>{const e=k(r,"documentId");return o.map(s=>({...s,...e.get(s.documentId)}))},[r,o]),{mutate:c}=w(),{mutate:l}=H(),{mutate:u}=U();return t.jsx(B,{data:d,getRowId:e=>`${e.documentId}-${e.entityType}-${e.entityId}`,state:{isLoading:m||i},columns:[{accessorKey:"documentName",header:"Dokumentnamn",Cell:({cell:e,row:s})=>t.jsx(j,{component:b,to:`/documents/${s.original.documentId}`,children:e.getValue()})},{accessorFn:e=>{var s;return(s=e.content)==null?void 0:s.type},header:"Filtyp",enableEditing:!1},{accessorFn:e=>{var s;return y((s=e.content)==null?void 0:s.lastModified)},header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>f(N(e.getValue()))}],renderEditRowDialogContent:({row:e,table:s})=>t.jsxs(t.Fragment,{children:[t.jsx(S,{variant:"h4",color:"primary",children:s.getState().creatingRow?"Nytt dokument":"Redigera dokument"}),t.jsx(F,{children:t.jsx(_,{sx:{mt:1},enableExistingDocuments:!!s.getState().creatingRow,formProps:{defaultValues:{...n,...e.original}},onChange:g=>{e._valuesCache=g}})}),t.jsx(M,{children:t.jsx(E,{row:e,table:s,variant:"text"})})]}),onCreate:e=>c(e,{onSuccess:s=>l({...e,documentId:s})}),onUpdate:e=>c(e),onDelete:e=>u(e)})},fe=()=>{const o=I(),i=C(),{data:n,isLoading:r}=Y(o.id==="new"?void 0:Number(o.id)),{mutate:m}=O(),{mutate:d}=Q(),{mutate:c}=W(),{data:l=[],isLoading:u}=G({entityType:"assignment",entityId:n==null?void 0:n.assignmentId}),{data:e=[],isLoading:s}=K(),g=x.useMemo(()=>e.filter(a=>$(a.contacts,(n==null?void 0:n.responsibleContacts)||[],"contactId").length>0),[e,n]),h=a=>{n?d(a):m(a,{onSuccess:D=>i(`/home/assignments/${D.assignmentId}`)})};if(!r)return t.jsx(X,{formProps:{values:n},onSubmit:h,renderTopContent:()=>t.jsxs(v,{sx:{position:"relative",mt:1,mb:3},children:[t.jsxs(L,{spacing:2,direction:"row",sx:{position:"absolute",right:0},children:[n&&t.jsx(V,{onClick:()=>c(n,{onSuccess:()=>i("..")}),children:a=>t.jsx(p,{variant:"outlined",color:"error",...T(a),children:"Ta bort"})}),t.jsx(p,{variant:"outlined",color:"primary",onClick:()=>i(-1),children:"Avbryt"}),t.jsx(p,{type:"submit",variant:"contained",color:"primary",children:"Spara"})]}),t.jsx(A,{variant:"h4",color:"primary",children:n?"Redigera uppdrag":"LÃ¤gg till uppdrag"})]}),renderBottomContent:()=>n&&t.jsx(J,{sx:{mt:1,minHeight:`calc(100vh - ${R}px - 1rem)`},children:t.jsx(z,{tabs:[{id:"interactions",label:"Interaktioner",content:t.jsx(q,{interactions:g,isLoading:s,defaultValues:{contacts:[...n.responsibleContacts,n.externalContact].filter(a=>!!a),interactionDate:f()}})},{id:"documents",label:"Dokument",content:t.jsx(Z,{documentReferences:l,isLoading:u,defaultValues:{entityId:n.assignmentId,entityType:"assignment"}})},{id:"stakeholders",label:"Intressenter",content:t.jsx(t.Fragment,{children:"Intressenter..."})},{id:"modules",label:"Moduler",content:t.jsx(t.Fragment,{children:"Moduler..."})}]})})})};export{fe as default};
