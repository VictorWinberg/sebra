import{r as g,j as s,L as D,i as b,k as y,g as x,l as h,B as C,T as j,F as I,m as v}from"./index-CZ45jrlg.js";import{D as L}from"./DataTable-B35_rz3R.js";import{S as R}from"./SebraDialog-o6BWyFrT.js";import{f,t as T}from"./date-Y-53B5Rf.js";import{u as A,a as k,b as F,c as S,d as w,D as E}from"./DocumentForm-CsgNbz66.js";import{L as B}from"./Link-DsBu3IL1.js";import{u as V,I as _}from"./useInteractionsQueries-BgQojjbf.js";import{C as $}from"./ContentTabs-D7MD6LT3.js";import{F as K}from"./SebraForm-DTQg5eq8.js";import{u as U,a as q,b as H,A as M}from"./useAssignmentsMutations-BmfKMwx4.js";import{a as N}from"./useAssignmentsQueries-DlbNsHta.js";import"./useQueryParam-Dbvf8j_-.js";import"./Tooltip-CBMJeiY9.js";import"./index.esm-Bdx5lcuG.js";import"./useContactsQueries-BfPHabG1.js";import"./Tabs-CPvO6YOi.js";import"./MoreHoriz-CGYGGhl7.js";import"./FormControlLabel-C82TzeHR.js";import"./useCompaniesQueries-CqHYvfUk.js";(function(){try{var n=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new n.Error().stack;o&&(n._sentryDebugIds=n._sentryDebugIds||{},n._sentryDebugIds[o]="acb22493-03d3-4884-8d08-a3c169c6adc1",n._sentryDebugIdIdentifier="sentry-dbid-acb22493-03d3-4884-8d08-a3c169c6adc1")}catch{}})();const P=({defaultValues:n,where:o})=>{const{data:t=[],isLoading:c}=A(o),d=g.useMemo(()=>t.map(e=>e.document),[t]),{mutate:m}=k(),{mutate:u}=F(),{mutate:r}=S(),{mutate:l}=w();if(!c)return s.jsx(L,{data:d,getRowId:e=>e.id,state:{isLoading:c},columns:[{accessorKey:"alt",header:"Dokumentnamn",Cell:({cell:e,row:a})=>s.jsx(B,{component:D,to:`/documents/${a.original.id}`,children:e.getValue()})},{accessorKey:"mimeType",header:"Filtyp",enableEditing:!1},{accessorKey:"updatedAt",accessorFn:e=>b(e.updatedAt),header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>f(T(e.getValue()))}],renderEditRowDialogContent:({row:e,table:a})=>s.jsx(R,{table:a,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:E}),onCreate:e=>{e.upload?m(e,{onSuccess:a=>r({...n,document:a.doc})}):r({...n,document:e})},onUpdate:e=>u(e),onDelete:e=>l(t.find(a=>a.document.id===e.id))})},me=()=>{const n=y(),o=x(),{data:t,isLoading:c}=N(n.id==="new"?void 0:n.id),{mutate:d}=U(),{mutate:m}=q(),{mutate:u}=H(),{data:r=[],isLoading:l}=V(),e=g.useMemo(()=>r.filter(i=>h(i.contacts||[],(t==null?void 0:t.responsibleContacts)||[],"id").length>0),[r,t]),a=i=>{t?m({...i,id:t.id}):d(i,{onSuccess:({createAssignment:p})=>o(`/home/assignments/${(p==null?void 0:p.id)||""}`)})};if(!c)return s.jsx(M,{formProps:{values:t},onSubmit:a,renderTopContent:()=>s.jsxs(C,{sx:{position:"relative",mt:1,mb:3},children:[s.jsx(j,{variant:"h4",color:"primary",children:t?"Redigera uppdrag":"LÃ¤gg till uppdrag"}),s.jsx(K,{sx:{position:"absolute",top:0,right:0},onDelete:t?()=>u(t,{onSuccess:()=>o("..")}):void 0,onCancel:()=>o(-1)})]}),renderBottomContent:()=>t&&s.jsx(I,{sx:{mt:1,minHeight:`calc(100vh - ${v}px - 1rem)`},children:s.jsx($,{tabs:[{id:"interactions",label:"Interaktioner",content:s.jsx(_,{interactions:e,isLoading:l,defaultValues:{contacts:[...t.responsibleContacts||[],t.externalContact].filter(i=>!!i),interactionDate:f()}})},{id:"documents",label:"Dokument",content:s.jsx(P,{defaultValues:{entityId:t.id,entityType:"assignment"},where:{entityId:{equals:t.id},entityType:{equals:"assignment"}}})}]})})})};export{me as default};
//# sourceMappingURL=AssignmentEdit-DBaMuiw4.js.map
