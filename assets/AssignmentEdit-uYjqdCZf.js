import{r as h,j as t,g as D,L as j,h as b,i as y,k as I,B as v,S as C,f as p,l as L,T,m as A}from"./index-Bd6xTruv.js";import{t as R,D as k,a as S,b as F,M as E}from"./useSnackbar-DAvCiuvm.js";import{D as M,a as $}from"./DataTable-Bn-3yvjr.js";import{f as x,t as B}from"./date-D5hx8rTT.js";import{u as P,a as V,b as N,c as w,D as H,d as U}from"./DocumentForm-SseTzGw-.js";import{u as _,I as G}from"./useInteractionsQueries-CIchbm0S.js";import{C as K}from"./ContentTabs-DqNb2H1a.js";import{F as q}from"./FlexGrow-ErFmPyPr.js";import{u as z,a as J,b as O,A as Q}from"./useAssignmentsMutations-DZtx__Uh.js";import{a as W}from"./useAssignmentsQueries-BVl8YA9L.js";import"./MoreHoriz-BvVezgON.js";import"./index.esm-BJZkzNMk.js";import"./Tooltip-Di0BuYhK.js";import"./useQueryParam-B3HxR5Y7.js";import"./useContactsQueries-BES7-iDj.js";import"./useCompaniesQueries-DHFwAocb.js";const X=({documentReferences:o,isLoading:i,defaultValues:s})=>{const{data:r=[],isLoading:m}=P(),d=h.useMemo(()=>{const e=R(r,"documentId");return o.map(n=>({...n,...e.get(n.documentId)}))},[r,o]),{mutate:c}=V(),{mutate:l}=N(),{mutate:u}=w();return t.jsx(M,{data:d,getRowId:e=>`${e.documentId}-${e.entityType}-${e.entityId}`,state:{isLoading:m||i},columns:[{accessorKey:"documentName",header:"Dokumentnamn",Cell:({cell:e,row:n})=>t.jsx(D,{component:j,to:`/documents/${n.original.documentId}`,children:e.getValue()})},{accessorFn:e=>{var n;return(n=e.content)==null?void 0:n.type},header:"Filtyp",enableEditing:!1},{accessorFn:e=>{var n;return b((n=e.content)==null?void 0:n.lastModified)},header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>x(B(e.getValue()))}],renderEditRowDialogContent:({row:e,table:n})=>t.jsxs(t.Fragment,{children:[t.jsx(k,{variant:"h4",color:"primary",children:n.getState().creatingRow?"Nytt dokument":"Redigera dokument"}),t.jsx(S,{children:t.jsx(H,{sx:{mt:1},enableExistingDocuments:!!n.getState().creatingRow,formProps:{defaultValues:{...s,...e.original}},onChange:g=>{e._valuesCache=g}})}),t.jsx(F,{children:t.jsx(E,{row:e,table:n,variant:"text"})})]}),onCreate:e=>c(e,{onSuccess:n=>l({...e,documentId:n})}),onUpdate:e=>c(e),onDelete:e=>u(e)})},pe=()=>{const o=y(),i=I(),{data:s,isLoading:r}=W(o.id==="new"?void 0:Number(o.id)),{mutate:m}=z(),{mutate:d}=J(),{mutate:c}=O(),{data:l=[],isLoading:u}=U({entityType:"assignment",entityId:s==null?void 0:s.assignmentId}),{data:e=[],isLoading:n}=_(s?{contactId:s.responsiblePersonId}:void 0),g=a=>{s?d(a):m(a,{onSuccess:f=>i(`/home/assignments/${f.assignmentId}`)})};if(!r)return t.jsx(Q,{formProps:{values:s},onSubmit:g,renderTopContent:()=>t.jsxs(v,{sx:{position:"relative",mt:1,mb:3},children:[t.jsxs(C,{spacing:2,direction:"row",sx:{position:"absolute",right:0},children:[s&&t.jsx($,{onClick:()=>c(s,{onSuccess:()=>i("..")}),children:a=>t.jsx(p,{variant:"outlined",color:"error",...L(a),children:"Ta bort"})}),t.jsx(p,{variant:"outlined",color:"primary",onClick:()=>i(-1),children:"Avbryt"}),t.jsx(p,{type:"submit",variant:"contained",color:"primary",children:"Spara"})]}),t.jsx(T,{variant:"h4",color:"primary",children:s?"Redigera uppdrag":"LÃ¤gg till uppdrag"})]}),renderBottomContent:()=>s&&t.jsx(q,{sx:{mt:1,minHeight:`calc(100vh - ${A}px - 1rem)`},children:t.jsx(K,{tabs:[{id:"interactions",label:"Interaktioner",content:t.jsx(G,{interactions:e,isLoading:n,defaultValues:{contacts:[s.responsiblePerson,s.externalContactPerson].filter(a=>!!a),interactionDate:x()}})},{id:"documents",label:"Dokument",content:t.jsx(X,{documentReferences:l,isLoading:u,defaultValues:{entityId:s.assignmentId,entityType:"assignment"}})},{id:"stakeholders",label:"Intressenter",content:t.jsx(t.Fragment,{children:"Intressenter..."})},{id:"modules",label:"Moduler",content:t.jsx(t.Fragment,{children:"Moduler..."})}]})})})};export{pe as default};
