import{r as g,j as t,g as h,L as b,h as D,i as j,k as y,B as I,S as C,f as p,l as v,T as L,m as k}from"./index-4JUCeTbF.js";import{D as R}from"./DataTable-CKBkIaRG.js";import{S,D as A}from"./SebraDialog-CxgIUny0.js";import{f,t as T}from"./date-DKIv-wQj.js";import{t as F,i as M}from"./useSnackbar-CkwChgxw.js";import{u as E,a as w,b as B,c as N,d as V,D as $}from"./DocumentForm-BHpYdihW.js";import{u as K,I as H}from"./useInteractionsQueries-Bjez-Fpd.js";import{C as P}from"./ContentTabs-DHGXFkbg.js";import{F as U}from"./FlexGrow-DzYTkLTw.js";import{u as G,a as q,b as z,A as J}from"./useAssignmentsMutations-CuGBAZCB.js";import{a as O}from"./useAssignmentsQueries-DBy_n-_-.js";import"./useQueryParam-DhHureY5.js";import"./Tooltip-D5iUx3eh.js";import"./MoreHoriz-DBfnw4jB.js";import"./index.esm-eScS0gA7.js";import"./useContactsQueries-BH5dhfZS.js";import"./useCompaniesQueries-Z68uJHif.js";const Q=({defaultValues:r})=>{const{data:o=[],isLoading:s}=E(r),{data:i=[],isLoading:d}=w(),l=g.useMemo(()=>{const e=F(i,"documentId");return o.map(n=>e.get(n.documentId)).filter(n=>!!n)},[i,o]),{mutate:c}=B(),{mutate:m}=N(),{mutate:u}=V();return t.jsx(R,{data:l,getRowId:e=>e.documentId,state:{isLoading:d||s},columns:[{accessorKey:"documentName",header:"Dokumentnamn",Cell:({cell:e,row:n})=>t.jsx(h,{component:b,to:`/documents/${n.original.documentId}`,children:e.getValue()})},{accessorKey:"content.type",accessorFn:e=>{var n;return(n=e.content)==null?void 0:n.type},header:"Filtyp",enableEditing:!1},{accessorKey:"content.lastModified",accessorFn:e=>{var n;return D((n=e.content)==null?void 0:n.lastModified)},header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>f(T(e.getValue()))}],renderEditRowDialogContent:({row:e,table:n})=>t.jsx(S,{table:n,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:$}),onCreate:e=>c(e,{onSuccess:n=>m({...r,documentId:n})}),onUpdate:e=>c(e),onDelete:e=>u(e)})},ue=()=>{const r=j(),o=y(),{data:s,isLoading:i}=O(r.id==="new"?void 0:Number(r.id)),{mutate:d}=G(),{mutate:l}=q(),{mutate:c}=z(),{data:m=[],isLoading:u}=K(),e=g.useMemo(()=>m.filter(a=>M(a.contacts,(s==null?void 0:s.responsibleContacts)||[],"contactId").length>0),[m,s]),n=a=>{s?l(a):d(a,{onSuccess:x=>o(`/home/assignments/${x.assignmentId}`)})};if(!i)return t.jsx(J,{formProps:{values:s},onSubmit:n,renderTopContent:()=>t.jsxs(I,{sx:{position:"relative",mt:1,mb:3},children:[t.jsxs(C,{spacing:2,direction:"row",sx:{position:"absolute",right:0},children:[s&&t.jsx(A,{onClick:()=>c(s,{onSuccess:()=>o("..")}),children:a=>t.jsx(p,{variant:"outlined",color:"error",...v(a),children:"Ta bort"})}),t.jsx(p,{variant:"outlined",color:"primary",onClick:()=>o(-1),children:"Avbryt"}),t.jsx(p,{type:"submit",variant:"contained",color:"primary",children:"Spara"})]}),t.jsx(L,{variant:"h4",color:"primary",children:s?"Redigera uppdrag":"LÃ¤gg till uppdrag"})]}),renderBottomContent:()=>s&&t.jsx(U,{sx:{mt:1,minHeight:`calc(100vh - ${k}px - 1rem)`},children:t.jsx(P,{tabs:[{id:"interactions",label:"Interaktioner",content:t.jsx(H,{interactions:e,isLoading:u,defaultValues:{contacts:[...s.responsibleContacts,s.externalContact].filter(a=>!!a),interactionDate:f()}})},{id:"documents",label:"Dokument",content:t.jsx(Q,{defaultValues:{entityId:s.assignmentId,entityType:"assignment"}})},{id:"stakeholders",label:"Intressenter",content:t.jsx(t.Fragment,{children:"Intressenter..."})},{id:"modules",label:"Moduler",content:t.jsx(t.Fragment,{children:"Moduler..."})}]})})})};export{ue as default};
