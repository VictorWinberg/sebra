import{r as x,j as e,G as y,M as K,N as U,Q as A,w as P,i as V,k as G,B as O,S as q,f as b,l as W,T as Y,g as j,L as D,U as _}from"./index-4JUCeTbF.js";import{u as k}from"./useAssignmentsQueries-DBy_n-_-.js";import{u as L}from"./useCompaniesQueries-Z68uJHif.js";import{u as M}from"./useContactsQueries-BH5dhfZS.js";import{C as Q}from"./ContentTabs-DHGXFkbg.js";import{D as z}from"./DataTable-CKBkIaRG.js";import{D as H,S as J}from"./SebraDialog-CxgIUny0.js";import{F as X}from"./FlexGrow-DzYTkLTw.js";import{S as Z,A as ee,t as v}from"./useSnackbar-CkwChgxw.js";import{f as te,b as ne,e as ae,u as se,c as oe,g as re,d as ce,D as ie}from"./DocumentForm-BHpYdihW.js";import{u as me,C as I}from"./index.esm-eScS0gA7.js";import{M as R}from"./MoreHoriz-DBfnw4jB.js";import"./useQueryParam-DhHureY5.js";import"./Tooltip-D5iUx3eh.js";const le=[{label:"Bolag",value:"company"},{label:"Kontakt",value:"contact"},{label:"Uppdrag",value:"assignment"}],ue=({formProps:r,...c})=>{const{data:o=[]}=M(),{data:i=[]}=k(),{data:m=[]}=L(),{control:l,handleSubmit:u,watch:d,formState:{errors:p}}=me(r),g=d(),f=x.useMemo(()=>{switch(g.entityType){case"company":return m.map(n=>({id:n.companyId,label:n.companyName}));case"contact":return o.map(n=>({id:n.contactId,label:n.contactName}));case"assignment":return i.map(n=>({id:n.assignmentId,label:n.assignmentName}));default:return[]}},[g.entityType,m,o,i]);return e.jsx(Z,{...c,handleSubmit:u,children:e.jsxs(y,{container:!0,spacing:2,children:[e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsxs(K,{fullWidth:!0,variant:"outlined",error:!!p.entityType,children:[e.jsx(U,{children:"Typ"}),e.jsx(I,{control:l,name:"entityType",defaultValue:"",rules:{required:!0},render:({field:n})=>e.jsxs(A,{label:"Typ",...n,children:[e.jsx(R,{value:"",disabled:!0,children:"V채lj typ"}),le.map(a=>e.jsx(R,{value:a.value,children:a.label},a.value))]})})]})}),e.jsx(y,{item:!0,xs:12,sm:6,children:e.jsx(I,{name:"entityId",control:l,rules:{required:!0},render:({field:n})=>e.jsx(ee,{options:f,getOptionKey:a=>a.id,getOptionLabel:a=>a.label,value:f.find(a=>a.id===n.value)||null,onChange:(a,h)=>n.onChange(h?h.id:void 0),renderInput:a=>e.jsx(P,{...a,label:"L채nk",variant:"outlined",fullWidth:!0})})})})]})})},Ie=()=>{const r=V(),c=G(),{data:o,isLoading:i}=te(r.id==="new"?void 0:r.id),{mutate:m}=ne(),{mutate:l}=ae(),{data:u=[]}=L(),{data:d=[]}=M(),{data:p=[]}=k(),{data:g=[],isLoading:f}=se(r.id!=="new"?{documentId:r.id}:void 0),{mutate:n}=oe(),{mutate:a}=re(),{mutate:h}=ce(),N=x.useMemo(()=>v(u,"companyId"),[u]),w=x.useMemo(()=>v(d,"contactId"),[d]),F=x.useMemo(()=>v(p,"assignmentId"),[p]),$=t=>{m(t,{onSuccess:s=>c(`/documents/${s}`)})};if(i)return;const E=t=>{switch(t){case"company":return"Bolag";case"contact":return"Kontakt";case"assignment":return"Uppdrag";default:return null}},B=(t,s)=>{var T,C,S;switch(t){case"company":return e.jsx(j,{component:D,to:`/home/companies/${s}`,children:(T=N.get(s))==null?void 0:T.companyName});case"contact":return e.jsx(j,{component:D,to:`/home/contacts/${s}`,children:(C=w.get(s))==null?void 0:C.contactName});case"assignment":return e.jsx(j,{component:D,to:{pathname:`/home/assignments/${s}`,search:`${_({tab:"documents"})}`},children:(S=F.get(s))==null?void 0:S.assignmentName});default:return null}};return e.jsx(ie,{formProps:{defaultValues:o},onSubmit:$,renderTopContent:()=>e.jsxs(O,{sx:{position:"relative",mt:1,mb:3},children:[e.jsxs(q,{spacing:2,direction:"row",sx:{position:"absolute",right:0},children:[o&&e.jsx(H,{onClick:()=>l(o,{onSuccess:()=>c("..")}),children:t=>e.jsx(b,{variant:"outlined",color:"error",...W(t),children:"Ta bort"})}),e.jsx(b,{variant:"outlined",color:"primary",onClick:()=>c(-1),children:"Avbryt"}),e.jsx(b,{type:"submit",variant:"contained",color:"primary",children:"Spara"})]}),e.jsx(Y,{variant:"h4",color:"primary",children:o?"Redigera dokument":"L채gg till dokument"})]}),renderBottomContent:()=>o&&e.jsx(X,{children:e.jsx(Q,{tabs:[{id:"references",label:"Referenser",content:e.jsx(z,{data:g,getRowId:t=>`${t.documentId}-${t.entityType}-${t.entityId}`,state:{isLoading:f},columns:[{accessorKey:"entityType",header:"Typ",enableEditing:!1,Cell:({row:t})=>E(t.original.entityType)},{accessorKey:"entityId",header:"L채nk",enableEditing:!1,Cell:({row:t})=>B(t.original.entityType,t.original.entityId)}],renderEditRowDialogContent:({row:t,table:s})=>e.jsx(J,{table:s,row:t,titles:{creating:"Ny referens",editing:"Redigera referens"},FormComponent:ue,defaultValues:{documentId:o.documentId}}),onCreate:t=>n(t),onUpdate:(t,s)=>a({row:t,where:s}),onDelete:t=>h(t)})}]})})})};export{Ie as default};
