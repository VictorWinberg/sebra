{"version":3,"file":"useInteractionsQueries-Bi1Er666.js","sources":["../../src/features/interactions/api/interactionsApi.ts","../../src/features/interactions/hooks/useInteractionsMutations.ts","../../src/features/interactions/components/InteractionForm.tsx","../../src/features/interactions/components/InteractionTable.tsx","../../src/features/interactions/hooks/useInteractionsQueries.ts"],"sourcesContent":["import { v4 as uuidv4 } from 'uuid';\n\nimport { deleteQuery, insertManyQuery, insertQuery, query, updateQuery } from '@/api/DummyDB';\nimport { Contact } from '@/features/contacts/api/contactsApi';\nimport { pick, toMap } from '@/utils';\n\nexport type Interaction = InteractionRecord & { contacts: Contact[] };\n\nexport type InteractionRecord = {\n  id: string;\n  interactionDate: string;\n  interactionType: string;\n  notes: string;\n  createdAt: string;\n  updatedAt: string;\n};\n\ntype InteractionContact = {\n  interactionId: string;\n  contactId: string;\n};\n\nexport const fetchInteractions = async (): Promise<Interaction[]> => {\n  const interactionRecords = await query<InteractionRecord>(`SELECT * FROM interactions`);\n  const interactions: Interaction[] = interactionRecords.map((interaction) => ({ ...interaction, contacts: [] }));\n  const interactionMap = toMap(interactions, 'id');\n\n  const contacts = await query<Contact>(`SELECT * FROM contacts`);\n  const contactMap = toMap(contacts, 'id');\n\n  const interactionContacts = await query<InteractionContact>('SELECT * FROM interaction_contacts');\n  interactionContacts.forEach((interactionContact) => {\n    const interaction = interactionMap.get(interactionContact.interactionId);\n    const contact = contactMap.get(interactionContact.contactId);\n    if (!interaction || !contact) {\n      return;\n    }\n    interaction.contacts.push(contact);\n  });\n\n  return Array.from(interactionMap.values());\n};\n\nexport const createInteraction = async (interaction: Interaction) => {\n  const record = await insertQuery<InteractionRecord>(\n    'interactions',\n    pick({ ...interaction, interactionId: uuidv4() }, ['id', 'interactionType', 'interactionDate', 'notes'])\n  );\n  await createInteractionContacts({ id: record.id, contacts: interaction.contacts });\n};\n\nexport const updateInteraction = async (interaction: Interaction) => {\n  await updateQuery<InteractionRecord>(\n    'interactions',\n    pick(interaction, ['interactionType', 'interactionDate', 'notes']),\n    pick(interaction, ['id'])\n  );\n  await updateInteractionContacts(interaction);\n};\n\nexport const deleteInteraction = async (interaction: Pick<InteractionRecord, 'id'>) => {\n  await deleteInteractionContacts(interaction);\n  await deleteQuery<InteractionRecord>('interactions', pick(interaction, ['id']));\n};\n\nexport const createInteractionContacts = async (interaction: Pick<Interaction, 'id' | 'contacts'>) => {\n  await insertManyQuery<InteractionContact>(\n    'interaction_contacts',\n    interaction.contacts.map(({ id: contactId }) => ({ interactionId: interaction.id, contactId }))\n  );\n};\n\nconst updateInteractionContacts = async (interaction: Pick<Interaction, 'id' | 'contacts'>) => {\n  await deleteInteractionContacts(interaction);\n  await createInteractionContacts(interaction);\n};\n\nconst deleteInteractionContacts = async ({ id }: Pick<InteractionRecord, 'id'>) => {\n  await deleteQuery<InteractionContact>('interaction_contacts', { interactionId: id });\n};\n","import { useMutation, useQueryClient } from '@tanstack/react-query';\n\nimport { useSnackbar } from '@/hooks/useSnackbar';\nimport { createInteraction, deleteInteraction, updateInteraction } from '../api/interactionsApi';\n\nexport const useCreateInteraction = () => {\n  const queryClient = useQueryClient();\n  const { showSnackbar } = useSnackbar();\n\n  return useMutation({\n    mutationFn: createInteraction,\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['interactions'] });\n      showSnackbar('Interaktion sparat!');\n    },\n    onError: () => {\n      showSnackbar('Ett fel uppstod när interaktionen skulle sparas.', 'error');\n    }\n  });\n};\n\nexport const useUpdateInteraction = () => {\n  const queryClient = useQueryClient();\n  const { showSnackbar } = useSnackbar();\n\n  return useMutation({\n    mutationFn: updateInteraction,\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['interactions'] });\n      showSnackbar('Interaktion uppdaterat!');\n    },\n    onError: () => {\n      showSnackbar('Ett fel uppstod när interaktionen skulle uppdateras.', 'error');\n    }\n  });\n};\n\nexport const useDeleteInteraction = () => {\n  const queryClient = useQueryClient();\n  const { showSnackbar } = useSnackbar();\n\n  return useMutation({\n    mutationFn: deleteInteraction,\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['interactions'] });\n      showSnackbar('Interaktion borttaget!');\n    },\n    onError: () => {\n      showSnackbar('Ett fel uppstod när interaktionen skulle tas bort.', 'error');\n    }\n  });\n};\n","// material-ui\nimport { Autocomplete, Chip, Grid, TextField } from '@mui/material';\nimport { DateTimePicker } from '@mui/x-date-pickers';\n\n// third party\nimport dayjs from 'dayjs';\nimport { Controller, useForm } from 'react-hook-form';\n\n// project imports\nimport { useContacts } from '@/features/contacts/hooks/useContactsQueries';\nimport SebraForm, { FormProps } from '@/ui-component/SebraForm';\nimport { formatDate } from '@/utils';\nimport { Interaction } from '../api/interactionsApi';\n\n// ==============================|| INTERACTIONS FORM ||============================== //\n\nconst InteractionForm = ({ formProps, ...props }: FormProps<Interaction>) => {\n  const { data: contacts = [] } = useContacts();\n\n  const {\n    control,\n    handleSubmit,\n    register,\n    formState: { errors }\n  } = useForm<Interaction>(formProps);\n\n  return (\n    <SebraForm {...props} handleSubmit={handleSubmit}>\n      <Grid container spacing={2}>\n        <Grid item xs={12} sm={6}>\n          <Grid container spacing={2}>\n            <Grid item xs={12}>\n              <TextField\n                fullWidth\n                label=\"Typ av interaktion\"\n                type=\"text\"\n                margin=\"none\"\n                {...register('interactionType', { required: true })}\n                error={!!errors.interactionType}\n              />\n            </Grid>\n            <Grid item xs={12}>\n              <TextField\n                multiline\n                fullWidth\n                minRows={4}\n                label=\"Noteringar\"\n                type=\"text\"\n                margin=\"none\"\n                {...register('notes')}\n                error={!!errors.notes}\n              />\n            </Grid>\n          </Grid>\n        </Grid>\n        <Grid item xs={12} sm={6}>\n          <Grid container spacing={2}>\n            <Grid item xs={12}>\n              <Controller\n                control={control}\n                name=\"interactionDate\"\n                rules={{ required: true }}\n                render={({ field }) => {\n                  return (\n                    <DateTimePicker\n                      label=\"Interaktionsdatum\"\n                      value={dayjs(field.value)}\n                      inputRef={field.ref}\n                      onChange={(date) => field.onChange(formatDate(date))}\n                    />\n                  );\n                }}\n              />\n            </Grid>\n            <Grid item xs={12}>\n              <Controller\n                name=\"contacts\"\n                control={control}\n                render={({ field }) => (\n                  <Autocomplete\n                    multiple\n                    disableCloseOnSelect\n                    id=\"multiple-contacts\"\n                    options={contacts}\n                    getOptionKey={(option) => option.id}\n                    getOptionLabel={(option) => option.contactName}\n                    isOptionEqualToValue={(option, value) => option.id === value.id}\n                    value={field.value || []}\n                    onChange={(_, value) => field.onChange(value)}\n                    renderInput={(params) => (\n                      <TextField {...params} label=\"Kontakter\" variant=\"outlined\" fullWidth error={!!errors.contacts} />\n                    )}\n                    renderTags={(tags, getTagProps) => {\n                      return tags.map((option, index) => (\n                        <Chip {...getTagProps({ index })} key={option.id} label={option.contactName} />\n                      ));\n                    }}\n                  />\n                )}\n              />\n            </Grid>\n          </Grid>\n        </Grid>\n      </Grid>\n    </SebraForm>\n  );\n};\n\nexport default InteractionForm;\n","import { Link as RouterLink } from 'react-router-dom';\n\n// material-ui\nimport { Avatar, Chip, List, ListItem } from '@mui/material';\n\n// third party\nimport dayjs, { Dayjs } from 'dayjs';\n\n// project imports\nimport { Contact } from '@/features/contacts/api/contactsApi';\nimport DataTable from '@/ui-component/DataTable';\nimport SebraDialog from '@/ui-component/SebraDialog';\nimport { formatDate, stringAvatar, toLocalTime } from '@/utils';\nimport { Interaction } from '../api/interactionsApi';\nimport { useCreateInteraction, useDeleteInteraction, useUpdateInteraction } from '../hooks/useInteractionsMutations';\nimport InteractionForm from './InteractionForm';\n\ninterface InteractionTableProps {\n  interactions: Interaction[];\n  isLoading: boolean;\n  defaultValues: Partial<Interaction>;\n}\n\nconst InteractionTable = ({ interactions, isLoading, defaultValues }: InteractionTableProps) => {\n  const { mutate: createInteraction } = useCreateInteraction();\n  const { mutate: updateInteraction } = useUpdateInteraction();\n  const { mutate: deleteInteraction } = useDeleteInteraction();\n\n  return (\n    <DataTable\n      data={interactions}\n      getRowId={(row) => row.id}\n      state={{ isLoading }}\n      columns={[\n        {\n          accessorKey: 'interactionType',\n          header: 'Typ',\n          filterVariant: 'multi-select'\n        },\n        {\n          accessorKey: 'contacts',\n          header: 'Kontakter',\n          minSize: 150,\n          enableEditing: false,\n          Cell: ({ cell }) => (\n            <List disablePadding>\n              {cell.getValue<Contact[]>().map((contact) => (\n                <ListItem key={contact.id} sx={{ py: 0.25 }} disableGutters>\n                  <Chip\n                    component={RouterLink}\n                    variant=\"outlined\"\n                    avatar={<Avatar {...stringAvatar(contact.contactName)} />}\n                    label={contact.contactName}\n                    to={`/home/contacts/${contact.id}`}\n                    clickable\n                    size=\"small\"\n                  />\n                </ListItem>\n              ))}\n            </List>\n          )\n        },\n        {\n          accessorKey: 'notes',\n          header: 'Noteringar'\n        },\n        {\n          accessorFn: (row) => dayjs(row.interactionDate),\n          header: 'Interaktionsdatum',\n          filterVariant: 'date-range',\n          enableEditing: false,\n          Cell: ({ cell }) => formatDate(toLocalTime(cell.getValue<Dayjs>()))\n        }\n      ]}\n      renderEditRowDialogContent={({ row, table }) => (\n        <SebraDialog\n          table={table}\n          row={row}\n          titles={{ creating: 'Ny interaktion', editing: 'Redigera interaktion' }}\n          FormComponent={InteractionForm}\n          defaultValues={defaultValues}\n        />\n      )}\n      onCreate={(row) => createInteraction(row)}\n      onUpdate={(row) => updateInteraction(row)}\n      onDelete={(row) => deleteInteraction(row)}\n    />\n  );\n};\n\nexport default InteractionTable;\n","// third party\nimport { useQuery } from '@tanstack/react-query';\n\n// project imports\nimport { fetchInteractions } from '../api/interactionsApi';\n\nexport const useInteractions = () => {\n  return useQuery({\n    queryKey: ['interactions'],\n    queryFn: () => fetchInteractions()\n  });\n};\n"],"names":["fetchInteractions","interactions","query","interaction","interactionMap","toMap","contacts","contactMap","interactionContact","contact","createInteraction","record","insertQuery","pick","uuidv4","createInteractionContacts","updateInteraction","updateQuery","updateInteractionContacts","deleteInteraction","deleteInteractionContacts","deleteQuery","insertManyQuery","contactId","id","useCreateInteraction","queryClient","useQueryClient","showSnackbar","useSnackbar","useMutation","useUpdateInteraction","useDeleteInteraction","InteractionForm","formProps","props","useContacts","control","handleSubmit","register","errors","useForm","jsx","SebraForm","Grid","jsxs","TextField","Controller","field","DateTimePicker","dayjs","date","formatDate","Autocomplete","option","value","_","params","tags","getTagProps","index","createElement","Chip","InteractionTable","isLoading","defaultValues","DataTable","row","cell","List","ListItem","RouterLink","Avatar","stringAvatar","toLocalTime","table","SebraDialog","useInteractions","useQuery"],"mappings":"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"}