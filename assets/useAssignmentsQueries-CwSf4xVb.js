import{p as u,j as d,t as m,a as l}from"./SebraForm-BHSdrVvv.js";import{n as w,v as I,o as E,p as y,q as A,s as a,aj as M,X as S}from"./index-YJqmW9KL.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new s.Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="56970643-99dc-464f-9f3b-660e9784249c",s._sentryDebugIdIdentifier="sentry-dbid-56970643-99dc-464f-9f3b-660e9784249c")}catch{}})();const _=async()=>{const[s,t,n,e]=await Promise.all([a("SELECT * FROM assignments ORDER BY assignment_name"),a("SELECT * FROM assignment_responsible_contacts"),a("SELECT * FROM contacts"),a("SELECT * FROM companies")]),i=d(t,"assignmentId"),r=m(n,"id"),o=m(e,"id");return s.map(g(i,r,o))},F=async s=>{const[t,n,e,i]=await Promise.all([M("assignments",{id:s}),S("assignment_responsible_contacts",{assignmentId:s}),a("SELECT * FROM contacts"),a("SELECT * FROM companies")]),r=d(n,"assignmentId"),o=m(e,"id"),p=m(i,"id");return g(r,o,p)(t)},q=async s=>{const t=await w("assignments",u({...s,id:I()},["id","assignmentName","externalContactId","companyId","relevantFiles","fee","type","status"]));return await f({...s,...t}),t},Q=async s=>{await E("assignments",u(s,["assignmentName","externalContactId","companyId","relevantFiles","fee","type","status"]),u(s,["id"])),await L(s)},D=async({id:s})=>{await y("assignments",{id:s}),await b({id:s})};function g(s,t,n){return e=>{const o=(s.get(e.id)||[]).map(c=>c.contactId).map(c=>t.get(c)).filter(c=>!!c),p=t.get(e.externalContactId),C=n.get(e.companyId);return{...e,responsibleContacts:o,externalContact:p,company:C}}}const R=async()=>(await a("SELECT DISTINCT status FROM assignments")).map(({status:t})=>t).filter(Boolean),f=async({id:s,responsibleContacts:t})=>{!s||!t||await A("assignment_responsible_contacts",t.map(({id:n})=>({assignmentId:s,contactId:n})))},L=async s=>{await b(s),await f(s)},b=async({id:s})=>{s&&await y("assignment_responsible_contacts",{assignmentId:s})},v=()=>l({queryKey:["assignments"],queryFn:_}),x=s=>l({queryKey:["assignment",s],queryFn:()=>F(s),enabled:!!s}),h=()=>l({queryKey:["assignmentStatuses"],queryFn:R});export{x as a,h as b,q as c,Q as d,D as e,v as u};
//# sourceMappingURL=useAssignmentsQueries-CwSf4xVb.js.map
