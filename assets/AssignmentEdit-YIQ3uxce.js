import{r as p,j as o,i as b,L as D,k as y,l as x,g as h,B as I,T as C,F as j,m as L}from"./index-YJqmW9KL.js";import{D as R}from"./DataTable-BE7cnjIV.js";import{S as v}from"./SebraDialog-CUzs_nj7.js";import{f,t as A}from"./date-2dI2IryV.js";import{t as F,i as k,F as w}from"./SebraForm-BHSdrVvv.js";import{u as S,a as T,b as E,c as M,d as B,D as V}from"./DocumentForm-ISgJgLRe.js";import{u as _,I as $}from"./useInteractionsQueries-BopFQi0S.js";import{C as K}from"./ContentTabs-B5fbURPj.js";import{u as N,a as H,b as P,A as U}from"./useAssignmentsMutations-C88PMQrZ.js";import{a as G}from"./useAssignmentsQueries-CwSf4xVb.js";import"./useQueryParam-mKhBW43I.js";import"./Tooltip-Bq157Mjh.js";import"./MoreHoriz-x6EIQjlA.js";import"./index.esm-Ckl5Vq71.js";import"./Tabs-C1En54He.js";import"./useContactsQueries-BDDHK5Vo.js";import"./useCompaniesQueries-NfGHUcxQ.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new s.Error().stack;a&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[a]="45e73a06-b4b1-475f-aabc-8dfb887c13f5",s._sentryDebugIdIdentifier="sentry-dbid-45e73a06-b4b1-475f-aabc-8dfb887c13f5")}catch{}})();const q=({defaultValues:s})=>{const{data:a=[],isLoading:n}=S(s),{data:r=[],isLoading:d}=T(),u=p.useMemo(()=>{const e=F(r,"documentId");return a.map(t=>e.get(t.documentId)).filter(t=>!!t)},[r,a]),{mutate:c}=E(),{mutate:m}=M(),{mutate:l}=B();return o.jsx(R,{data:u,getRowId:e=>e.documentId,state:{isLoading:d||n},columns:[{accessorKey:"documentName",header:"Dokumentnamn",Cell:({cell:e,row:t})=>o.jsx(b,{component:D,to:`/documents/${t.original.documentId}`,children:e.getValue()})},{accessorKey:"content.type",accessorFn:e=>{var t;return(t=e.content)==null?void 0:t.type},header:"Filtyp",enableEditing:!1},{accessorKey:"content.lastModified",accessorFn:e=>{var t;return y((t=e.content)==null?void 0:t.lastModified)},header:"Senast uppdaterad",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>f(A(e.getValue()))}],renderEditRowDialogContent:({row:e,table:t})=>o.jsx(v,{table:t,row:e,titles:{creating:"Nytt dokument",editing:"Redigera dokument"},FormComponent:V}),onCreate:e=>c(e,{onSuccess:t=>m({...s,documentId:t})}),onUpdate:e=>c(e),onDelete:e=>l(e)})},me=()=>{const s=x(),a=h(),{data:n,isLoading:r}=G(s.id==="new"?void 0:s.id),{mutate:d}=N(),{mutate:u}=H(),{mutate:c}=P(),{data:m=[],isLoading:l}=_(),e=p.useMemo(()=>m.filter(i=>k(i.contacts,(n==null?void 0:n.responsibleContacts)||[],"id").length>0),[m,n]),t=i=>{n?u(i):d(i,{onSuccess:g=>a(`/home/assignments/${g.id}`)})};if(!r)return o.jsx(U,{formProps:{values:n},onSubmit:t,renderTopContent:()=>o.jsxs(I,{sx:{position:"relative",mt:1,mb:3},children:[o.jsx(C,{variant:"h4",color:"primary",children:n?"Redigera uppdrag":"LÃ¤gg till uppdrag"}),o.jsx(w,{sx:{position:"absolute",top:0,right:0},onDelete:n?()=>c(n,{onSuccess:()=>a("..")}):void 0,onCancel:()=>a(-1)})]}),renderBottomContent:()=>n&&o.jsx(j,{sx:{mt:1,minHeight:`calc(100vh - ${L}px - 1rem)`},children:o.jsx(K,{tabs:[{id:"interactions",label:"Interaktioner",content:o.jsx($,{interactions:e,isLoading:l,defaultValues:{contacts:[...n.responsibleContacts,n.externalContact].filter(i=>!!i),interactionDate:f()}})},{id:"documents",label:"Dokument",content:o.jsx(q,{defaultValues:{entityId:n.id,entityType:"assignment"}})}]})})})};export{me as default};
//# sourceMappingURL=AssignmentEdit-YIQ3uxce.js.map
