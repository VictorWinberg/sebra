import{n as D,v as T,o as q,p as k,q as F,s as p,t as f,w as b,j as n,G as i,x as y,k as C,r as R,C as j,d as K,e as L,L as Q,A as M,y as _}from"./index-YJqmW9KL.js";import{D as N}from"./DataTable-BE7cnjIV.js";import{S as O}from"./SebraDialog-CUzs_nj7.js";import{f as w,t as A}from"./date-2dI2IryV.js";import{p as m,t as I,u as x,S as V,D as G,A as W,a as z}from"./SebraForm-BHSdrVvv.js";import{u as P,C as h}from"./index.esm-Ckl5Vq71.js";import{u as U}from"./useContactsQueries-BDDHK5Vo.js";(function(){try{var t=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},a=new t.Error().stack;a&&(t._sentryDebugIds=t._sentryDebugIds||{},t._sentryDebugIds[a]="f8b52b2e-fc09-4fb7-a748-a03dec23e1fb",t._sentryDebugIdIdentifier="sentry-dbid-f8b52b2e-fc09-4fb7-a748-a03dec23e1fb")}catch{}})();const $=async()=>{const a=(await p("SELECT * FROM interactions")).map(e=>({...e,contacts:[]})),o=I(a,"id"),c=await p("SELECT * FROM contacts"),u=I(c,"id");return(await p("SELECT * FROM interaction_contacts")).forEach(e=>{const r=o.get(e.interactionId),s=u.get(e.contactId);!r||!s||r.contacts.push(s)}),Array.from(o.values())},B=async t=>{const a=await D("interactions",m({...t,interactionId:T()},["id","interactionType","interactionDate","notes"]));await E({id:a.id,contacts:t.contacts})},H=async t=>{await q("interactions",m(t,["interactionType","interactionDate","notes"]),m(t,["id"])),await X(t)},J=async t=>{await S(t),await k("interactions",m(t,["id"]))},E=async t=>{await F("interaction_contacts",t.contacts.map(({id:a})=>({interactionId:t.id,contactId:a})))},X=async t=>{await S(t),await E(t)},S=async({id:t})=>{await k("interaction_contacts",{interactionId:t})},Y=()=>{const t=f(),{showSnackbar:a}=b();return x({mutationFn:B,onSuccess:()=>{t.invalidateQueries({queryKey:["interactions"]}),a("Interaktion sparat!")},onError:()=>{a("Ett fel uppstod när interaktionen skulle sparas.","error")}})},Z=()=>{const t=f(),{showSnackbar:a}=b();return x({mutationFn:H,onSuccess:()=>{t.invalidateQueries({queryKey:["interactions"]}),a("Interaktion uppdaterat!")},onError:()=>{a("Ett fel uppstod när interaktionen skulle uppdateras.","error")}})},tt=()=>{const t=f(),{showSnackbar:a}=b();return x({mutationFn:J,onSuccess:()=>{t.invalidateQueries({queryKey:["interactions"]}),a("Interaktion borttaget!")},onError:()=>{a("Ett fel uppstod när interaktionen skulle tas bort.","error")}})},et=({formProps:t,...a})=>{const{data:o=[]}=U(),{control:c,handleSubmit:u,register:l,formState:{errors:e}}=P(t);return n.jsx(V,{...a,handleSubmit:u,children:n.jsxs(i,{container:!0,spacing:2,children:[n.jsx(i,{item:!0,xs:12,sm:6,children:n.jsxs(i,{container:!0,spacing:2,children:[n.jsx(i,{item:!0,xs:12,children:n.jsx(y,{fullWidth:!0,label:"Typ av interaktion",type:"text",margin:"none",...l("interactionType",{required:!0}),error:!!e.interactionType})}),n.jsx(i,{item:!0,xs:12,children:n.jsx(y,{multiline:!0,fullWidth:!0,minRows:4,label:"Noteringar",type:"text",margin:"none",...l("notes"),error:!!e.notes})})]})}),n.jsx(i,{item:!0,xs:12,sm:6,children:n.jsxs(i,{container:!0,spacing:2,children:[n.jsx(i,{item:!0,xs:12,children:n.jsx(h,{control:c,name:"interactionDate",rules:{required:!0},render:({field:r})=>n.jsx(G,{label:"Interaktionsdatum",value:C(r.value),inputRef:r.ref,onChange:s=>r.onChange(w(s))})})}),n.jsx(i,{item:!0,xs:12,children:n.jsx(h,{name:"contacts",control:c,render:({field:r})=>n.jsx(W,{multiple:!0,disableCloseOnSelect:!0,id:"multiple-contacts",options:o,getOptionKey:s=>s.id,getOptionLabel:s=>s.contactName,isOptionEqualToValue:(s,d)=>s.id===d.id,value:r.value||[],onChange:(s,d)=>r.onChange(d),renderInput:s=>n.jsx(y,{...s,label:"Kontakter",variant:"outlined",fullWidth:!0,error:!!e.contacts}),renderTags:(s,d)=>s.map((g,v)=>R.createElement(j,{...d({index:v}),key:g.id,label:g.contactName}))})})})]})})]})})},ut=({interactions:t,isLoading:a,defaultValues:o})=>{const{mutate:c}=Y(),{mutate:u}=Z(),{mutate:l}=tt();return n.jsx(N,{data:t,getRowId:e=>e.id,state:{isLoading:a},columns:[{accessorKey:"interactionType",header:"Typ",filterVariant:"multi-select"},{accessorKey:"contacts",header:"Kontakter",minSize:150,enableEditing:!1,Cell:({cell:e})=>n.jsx(K,{disablePadding:!0,children:e.getValue().map(r=>n.jsx(L,{sx:{py:.25},disableGutters:!0,children:n.jsx(j,{component:Q,variant:"outlined",avatar:n.jsx(M,{..._(r.contactName)}),label:r.contactName,to:`/home/contacts/${r.id}`,clickable:!0,size:"small"})},r.id))})},{accessorKey:"notes",header:"Noteringar"},{accessorFn:e=>C(e.interactionDate),header:"Interaktionsdatum",filterVariant:"date-range",enableEditing:!1,Cell:({cell:e})=>w(A(e.getValue()))}],renderEditRowDialogContent:({row:e,table:r})=>n.jsx(O,{table:r,row:e,titles:{creating:"Ny interaktion",editing:"Redigera interaktion"},FormComponent:et,defaultValues:o}),onCreate:e=>c(e),onUpdate:e=>u(e),onDelete:e=>l(e)})},lt=()=>z({queryKey:["interactions"],queryFn:()=>$()});export{ut as I,lt as u};
//# sourceMappingURL=useInteractionsQueries-BopFQi0S.js.map
