import{r as h,j as e,G as b,S as B,U as _,V as K,x as U,l as V,g as A,B as P,T as G,F as O,i as x,L as D,W}from"./index-FssDv7LW.js";import{u as R}from"./useAssignmentsQueries-cBAqmJor.js";import{u as L}from"./useCompaniesQueries-CiA-WbpT.js";import{u as w}from"./useContactsQueries-B7hTPA4C.js";import{C as q}from"./ContentTabs-B-DN5VR_.js";import{D as Y}from"./DataTable-BHmh57m2.js";import{S as z}from"./SebraDialog-ItKfkUVs.js";import{S as H,A as J,t as j,F as Q}from"./SebraForm-CHd36EfM.js";import{f as X,b as Z,e as ee,u as te,c as ne,g as ae,d as se,D as oe}from"./DocumentForm-cHQEqSFc.js";import{u as re,C as S}from"./index.esm-CuAyuT5m.js";import{M as I}from"./MoreHoriz-B1DyK4sx.js";import"./useQueryParam-BFPdhiEV.js";import"./Tabs-HVe84a-j.js";import"./Tooltip-CRgNR65U.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},c=new s.Error().stack;c&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[c]="9c6c3f6b-7266-400e-8254-087209158a86",s._sentryDebugIdIdentifier="sentry-dbid-9c6c3f6b-7266-400e-8254-087209158a86")}catch{}})();const ce=[{label:"Bolag",value:"company"},{label:"Kontakt",value:"contact"},{label:"Uppdrag",value:"assignment"}],ie=({formProps:s,...c})=>{const{data:r=[]}=w(),{data:i=[]}=R(),{data:m=[]}=L(),{control:u,handleSubmit:d,watch:l,formState:{errors:p}}=re(s),f=l(),g=h.useMemo(()=>{switch(f.entityType){case"company":return m.map(n=>({id:n.id,label:n.companyName}));case"contact":return r.map(n=>({id:n.id,label:n.contactName}));case"assignment":return i.map(n=>({id:n.id,label:n.assignmentName}));default:return[]}},[f.entityType,m,r,i]);return e.jsx(H,{...c,handleSubmit:d,children:e.jsxs(b,{container:!0,spacing:2,children:[e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsxs(B,{fullWidth:!0,variant:"outlined",error:!!p.entityType,children:[e.jsx(_,{children:"Typ"}),e.jsx(S,{control:u,name:"entityType",defaultValue:"",rules:{required:!0},render:({field:n})=>e.jsxs(K,{label:"Typ",...n,children:[e.jsx(I,{value:"",disabled:!0,children:"V채lj typ"}),ce.map(a=>e.jsx(I,{value:a.value,children:a.label},a.value))]})})]})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsx(S,{name:"entityId",control:u,rules:{required:!0},render:({field:n})=>e.jsx(J,{options:g,getOptionKey:a=>a.id,getOptionLabel:a=>a.label,value:g.find(a=>a.id===n.value)||null,onChange:(a,y)=>n.onChange(y?y.id:void 0),renderInput:a=>e.jsx(U,{...a,label:"L채nk",variant:"outlined",fullWidth:!0})})})})]})})},Te=()=>{const s=V(),c=A(),{data:r,isLoading:i}=X(s.id==="new"?void 0:s.id),{mutate:m}=Z(),{mutate:u}=ee(),{data:d=[]}=L(),{data:l=[]}=w(),{data:p=[]}=R(),{data:f=[],isLoading:g}=te(s.id!=="new"?{documentId:s.id}:void 0),{mutate:n}=ne(),{mutate:a}=ae(),{mutate:y}=se(),F=h.useMemo(()=>j(d,"id"),[d]),k=h.useMemo(()=>j(l,"id"),[l]),M=h.useMemo(()=>j(p,"id"),[p]),E=t=>{m(t,{onSuccess:o=>c(`/documents/${o}`)})};if(i)return;const N=t=>{switch(t){case"company":return"Bolag";case"contact":return"Kontakt";case"assignment":return"Uppdrag";default:return null}},$=(t,o)=>{var v,T,C;switch(t){case"company":return e.jsx(x,{component:D,to:`/home/companies/${o}`,children:(v=F.get(o))==null?void 0:v.companyName});case"contact":return e.jsx(x,{component:D,to:`/home/contacts/${o}`,children:(T=k.get(o))==null?void 0:T.contactName});case"assignment":return e.jsx(x,{component:D,to:{pathname:`/home/assignments/${o}`,search:`${W({tab:"documents"})}`},children:(C=M.get(o))==null?void 0:C.assignmentName});default:return null}};return e.jsx(oe,{formProps:{defaultValues:r},onSubmit:E,renderTopContent:()=>e.jsxs(P,{sx:{position:"relative",mt:1,mb:3},children:[e.jsx(G,{variant:"h4",color:"primary",children:r?"Redigera dokument":"L채gg till dokument"}),e.jsx(Q,{sx:{position:"absolute",top:0,right:0},onDelete:r?()=>u(r,{onSuccess:()=>c("..")}):void 0,onCancel:()=>c(-1)})]}),renderBottomContent:()=>r&&e.jsx(O,{children:e.jsx(q,{tabs:[{id:"references",label:"Referenser",content:e.jsx(Y,{data:f,getRowId:t=>`${t.documentId}-${t.entityType}-${t.entityId}`,state:{isLoading:g},columns:[{accessorKey:"entityType",header:"Typ",enableEditing:!1,Cell:({row:t})=>N(t.original.entityType)},{accessorKey:"entityId",header:"L채nk",enableEditing:!1,Cell:({row:t})=>$(t.original.entityType,t.original.entityId)}],renderEditRowDialogContent:({row:t,table:o})=>e.jsx(z,{table:o,row:t,titles:{creating:"Ny referens",editing:"Redigera referens"},FormComponent:ie,defaultValues:{documentId:r.documentId}}),onCreate:t=>n(t),onUpdate:(t,o)=>a({row:t,where:o}),onDelete:t=>y(t)})}]})})})};export{Te as default};
//# sourceMappingURL=DocumentEdit-KvP62X1r.js.map
